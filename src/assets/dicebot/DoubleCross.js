/* Generated by Opal 0.11.4 */
(function(Opal) {
  function $rb_minus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);
  }
  function $rb_divide(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs / rhs : lhs['$/'](rhs);
  }
  function $rb_plus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);
  }
  function $rb_times(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs * rhs : lhs['$*'](rhs);
  }
  function $rb_lt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs < rhs : lhs['$<'](rhs);
  }
  function $rb_ge(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs >= rhs : lhs['$>='](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice, $klass = Opal.klass, $send = Opal.send, $truthy = Opal.truthy, $hash2 = Opal.hash2;

  Opal.add_stubs(['$freeze', '$attr_reader', '$map', '$to_proc', '$join', '$clearPrefixes', '$!', '$empty?', '$prefixs', '$prefixes', '$class', '$warn', '$gameType', '$setPrefixes', '$attr_accessor', '$gameName', '$getHelpMessage', '$attr_writer', '$rand', '$check_suc', '$roll', '$marshalSignOfInequality', '$unlimitedRollDiceType', '$getD66Value', '$rollDiceAddingUp', '$parren_killer', '$debug', '$isGetOriginalMessage', '$getOriginalMessage', '$=~', '$prefixesPattern', '$last_match', '$removeDiceCommandMessage', '$rollDiceCommandCatched', '$nil?', '$!=', '$sub', '$rollDiceCommand', '$to_s', '$backtrace', '$get_table_by_nD6', '$get_table_by_nDx', '$getTableValue', '$[]', '$-', '$/', '$getD66', '$bcdice', '$get_table_by_number', '$+', '$*', '$<', '$==', '$getDiceListFromDiceText', '$collect', '$split', '$to_i', '$each', '$>=', '$kind_of?', '$lambda', '$call', '$select', '$public_methods', '$===', '$send', '$upcase', '$getTableInfoFromExtraTableText', '$get_table_by_nDx_extratable', '$get_table_by_d66', '$floor', '$%', '$get_table_by_d66_swap', '$raise', '$gsub', '$rollTableMessageDiceText', '$is_a?', '$size', '$inspect']);
  return (function($base, $super, $parent_nesting) {
    function $DiceBot(){};
    var self = $DiceBot = $klass($base, $super, 'DiceBot', $DiceBot);

    var def = self.$$proto, $nesting = [self].concat($parent_nesting), TMP_DiceBot_setPrefixes_1, TMP_DiceBot_clearPrefixes_2, TMP_DiceBot_inherited_3, TMP_DiceBot_initialize_4, TMP_DiceBot_postSet_5, TMP_DiceBot_info_6, TMP_DiceBot_gameName_7, TMP_DiceBot_prefixes_8, TMP_DiceBot_setGameType_9, TMP_DiceBot_setSendMode_10, TMP_DiceBot_bcdice$eq_11, TMP_DiceBot_bcdice_12, TMP_DiceBot_rand_13, TMP_DiceBot_check_suc_14, TMP_DiceBot_roll_15, TMP_DiceBot_marshalSignOfInequality_16, TMP_DiceBot_unlimitedRollDiceType_17, TMP_DiceBot_setSortType_18, TMP_DiceBot_d66_19, TMP_DiceBot_rollDiceAddingUp_20, TMP_DiceBot_getHelpMessage_21, TMP_DiceBot_parren_killer_22, TMP_DiceBot_changeText_23, TMP_DiceBot_dice_command_24, TMP_DiceBot_isGetOriginalMessage_25, TMP_DiceBot_removeDiceCommandMessage_26, TMP_DiceBot_rollDiceCommandCatched_27, TMP_DiceBot_rollDiceCommand_28, TMP_DiceBot_setDiceText_29, TMP_DiceBot_setDiffText_30, TMP_DiceBot_dice_command_xRn_31, TMP_DiceBot_check_2D6_32, TMP_DiceBot_check_nD6_33, TMP_DiceBot_check_nD10_34, TMP_DiceBot_check_1D100_35, TMP_DiceBot_check_1D20_36, TMP_DiceBot_get_table_by_2d6_37, TMP_DiceBot_get_table_by_1d6_38, TMP_DiceBot_get_table_by_nD6_39, TMP_DiceBot_get_table_by_nDx_40, TMP_DiceBot_get_table_by_1d3_41, TMP_DiceBot_getD66_42, TMP_DiceBot_get_table_by_d66_swap_43, TMP_DiceBot_get_table_by_d66_44, TMP_DiceBot_getDiceRolledAdditionalText_45, TMP_DiceBot_getDiceRevision_46, TMP_DiceBot_changeDiceValueByDiceText_47, TMP_DiceBot_setRatingTable_48, TMP_DiceBot_isD9_49, TMP_DiceBot_getGrichText_50, TMP_DiceBot_check2dCritical_51, TMP_DiceBot_is2dCritical_52, TMP_DiceBot_should_reroll$q_53, TMP_DiceBot_getDiceList_54, TMP_DiceBot_getDiceListFromDiceText_56, TMP_DiceBot_get_table_by_number_58, TMP_DiceBot_getTableValue_60, TMP_DiceBot_analyzeDiceCommandResultMethod_63, TMP_DiceBot_get_table_by_nDx_extratable_64, TMP_DiceBot_getTableCommandResult_65, TMP_DiceBot_getTableInfoFromExtraTableText_67, TMP_DiceBot_roll_tables_68;

    def.rerollLimitCount = def.diceText = def.d66Type = nil;
    
    Opal.const_set($nesting[0], 'EMPTY_PREFIXES_PATTERN', /(^|\s)(S)?()(\s|$)/i.$freeze());
    (function(self, $parent_nesting) {
      var def = self.$$proto, $nesting = [self].concat($parent_nesting);

      return self.$attr_reader("prefixes")
    })(Opal.get_singleton_class(self), $nesting);
    (function(self, $parent_nesting) {
      var def = self.$$proto, $nesting = [self].concat($parent_nesting);

      return self.$attr_reader("prefixesPattern")
    })(Opal.get_singleton_class(self), $nesting);
    Opal.defs(self, '$setPrefixes', TMP_DiceBot_setPrefixes_1 = function $$setPrefixes(prefixes) {
      var self = this;

      
      self.prefixes = $send(prefixes, 'map', [], "freeze".$to_proc()).$freeze();
      self.prefixesPattern = new RegExp("" + "(^|\\s)(S)?(" + (prefixes.$join("|")) + ")(\\s|$)", 'i').$freeze();
      return self;
    }, TMP_DiceBot_setPrefixes_1.$$arity = 1);
    Opal.defs(self, '$clearPrefixes', TMP_DiceBot_clearPrefixes_2 = function $$clearPrefixes() {
      var self = this;

      
      self.prefixes = [].$freeze();
      self.prefixesPattern = Opal.const_get_relative($nesting, 'EMPTY_PREFIXES_PATTERN');
      return self;
    }, TMP_DiceBot_clearPrefixes_2.$$arity = 0);
    Opal.defs(self, '$inherited', TMP_DiceBot_inherited_3 = function $$inherited(subclass) {
      var self = this;

      return subclass.$clearPrefixes()
    }, TMP_DiceBot_inherited_3.$$arity = 1);
    self.$clearPrefixes();
    (Opal.class_variable_set($DiceBot, '@@bcdice', nil));
    (Opal.class_variable_set($DiceBot, '@@DEFAULT_SEND_MODE', 2));
    
    Opal.defn(self, '$initialize', TMP_DiceBot_initialize_4 = function $$initialize() {
      var $a, self = this;

      
      self.sendMode = (($a = $DiceBot.$$cvars['@@DEFAULT_SEND_MODE']) == null ? nil : $a);
      self.sortType = 0;
      self.sameDiceRerollCount = 0;
      self.sameDiceRerollType = 0;
      self.d66Type = 1;
      self.isPrintMaxDice = false;
      self.upplerRollThreshold = 0;
      self.unlimitedRollDiceType = 0;
      self.rerollNumber = 0;
      self.defaultSuccessTarget = "";
      self.rerollLimitCount = 10000;
      self.fractionType = "omit";
      self.gameType = "DiceBot";
      if ($truthy(($truthy($a = self.$prefixs()['$empty?']()['$!']()) ? self.$class().$prefixes()['$empty?']() : $a))) {
        
        self.$warn("" + (self.$gameType()) + ": #prefixs is deprecated. Please use .setPrefixes.");
        return self.$class().$setPrefixes(self.$prefixs());
        } else {
        return nil
      };
    }, TMP_DiceBot_initialize_4.$$arity = 0);
    self.$attr_accessor("rerollLimitCount");
    self.$attr_reader("sendMode", "sameDiceRerollCount", "sameDiceRerollType", "d66Type");
    self.$attr_reader("isPrintMaxDice", "upplerRollThreshold");
    self.$attr_reader("defaultSuccessTarget", "rerollNumber", "fractionType");
    
    Opal.defn(self, '$postSet', TMP_DiceBot_postSet_5 = function $$postSet() {
      var self = this;

      return nil
    }, TMP_DiceBot_postSet_5.$$arity = 0);
    
    Opal.defn(self, '$info', TMP_DiceBot_info_6 = function $$info() {
      var self = this;

      return $hash2(["name", "gameType", "prefixs", "info"], {"name": self.$gameName(), "gameType": self.$gameType(), "prefixs": self.$class().$prefixes(), "info": self.$getHelpMessage()})
    }, TMP_DiceBot_info_6.$$arity = 0);
    
    Opal.defn(self, '$gameName', TMP_DiceBot_gameName_7 = function $$gameName() {
      var self = this;

      return self.$gameType()
    }, TMP_DiceBot_gameName_7.$$arity = 0);
    
    Opal.defn(self, '$prefixes', TMP_DiceBot_prefixes_8 = function $$prefixes() {
      var self = this;

      return self.$class().$prefixes()
    }, TMP_DiceBot_prefixes_8.$$arity = 0);
    Opal.alias(self, "prefixs", "prefixes");
    self.$attr_reader("gameType");
    
    Opal.defn(self, '$setGameType', TMP_DiceBot_setGameType_9 = function $$setGameType(type) {
      var self = this;

      return (self.gameType = type)
    }, TMP_DiceBot_setGameType_9.$$arity = 1);
    
    Opal.defn(self, '$setSendMode', TMP_DiceBot_setSendMode_10 = function $$setSendMode(m) {
      var self = this;

      return (self.sendMode = m)
    }, TMP_DiceBot_setSendMode_10.$$arity = 1);
    self.$attr_writer("upplerRollThreshold");
    
    Opal.defn(self, '$bcdice=', TMP_DiceBot_bcdice$eq_11 = function(b) {
      var self = this;

      return (Opal.class_variable_set($DiceBot, '@@bcdice', b))
    }, TMP_DiceBot_bcdice$eq_11.$$arity = 1);
    
    Opal.defn(self, '$bcdice', TMP_DiceBot_bcdice_12 = function $$bcdice() {
      var $a, self = this;

      return (($a = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $a)
    }, TMP_DiceBot_bcdice_12.$$arity = 0);
    
    Opal.defn(self, '$rand', TMP_DiceBot_rand_13 = function $$rand(max) {
      var $a, self = this;

      return (($a = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $a).$rand(max)
    }, TMP_DiceBot_rand_13.$$arity = 1);
    
    Opal.defn(self, '$check_suc', TMP_DiceBot_check_suc_14 = function $$check_suc($a_rest) {
      var $b, self = this, params;

      var $args_len = arguments.length, $rest_len = $args_len - 0;
      if ($rest_len < 0) { $rest_len = 0; }
      params = new Array($rest_len);
      for (var $arg_idx = 0; $arg_idx < $args_len; $arg_idx++) {
        params[$arg_idx - 0] = arguments[$arg_idx];
      }
      return $send((($b = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $b), 'check_suc', Opal.to_a(params))
    }, TMP_DiceBot_check_suc_14.$$arity = -1);
    
    Opal.defn(self, '$roll', TMP_DiceBot_roll_15 = function $$roll($a_rest) {
      var $b, self = this, args;

      var $args_len = arguments.length, $rest_len = $args_len - 0;
      if ($rest_len < 0) { $rest_len = 0; }
      args = new Array($rest_len);
      for (var $arg_idx = 0; $arg_idx < $args_len; $arg_idx++) {
        args[$arg_idx - 0] = arguments[$arg_idx];
      }
      return $send((($b = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $b), 'roll', Opal.to_a(args))
    }, TMP_DiceBot_roll_15.$$arity = -1);
    
    Opal.defn(self, '$marshalSignOfInequality', TMP_DiceBot_marshalSignOfInequality_16 = function $$marshalSignOfInequality($a_rest) {
      var $b, self = this, args;

      var $args_len = arguments.length, $rest_len = $args_len - 0;
      if ($rest_len < 0) { $rest_len = 0; }
      args = new Array($rest_len);
      for (var $arg_idx = 0; $arg_idx < $args_len; $arg_idx++) {
        args[$arg_idx - 0] = arguments[$arg_idx];
      }
      return $send((($b = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $b), 'marshalSignOfInequality', Opal.to_a(args))
    }, TMP_DiceBot_marshalSignOfInequality_16.$$arity = -1);
    
    Opal.defn(self, '$unlimitedRollDiceType', TMP_DiceBot_unlimitedRollDiceType_17 = function $$unlimitedRollDiceType() {
      var $a, self = this;

      return (($a = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $a).$unlimitedRollDiceType()
    }, TMP_DiceBot_unlimitedRollDiceType_17.$$arity = 0);
    self.$attr_reader("sortType");
    
    Opal.defn(self, '$setSortType', TMP_DiceBot_setSortType_18 = function $$setSortType(s) {
      var self = this;

      return (self.sortType = s)
    }, TMP_DiceBot_setSortType_18.$$arity = 1);
    
    Opal.defn(self, '$d66', TMP_DiceBot_d66_19 = function $$d66($a_rest) {
      var $b, self = this, args;

      var $args_len = arguments.length, $rest_len = $args_len - 0;
      if ($rest_len < 0) { $rest_len = 0; }
      args = new Array($rest_len);
      for (var $arg_idx = 0; $arg_idx < $args_len; $arg_idx++) {
        args[$arg_idx - 0] = arguments[$arg_idx];
      }
      return $send((($b = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $b), 'getD66Value', Opal.to_a(args))
    }, TMP_DiceBot_d66_19.$$arity = -1);
    
    Opal.defn(self, '$rollDiceAddingUp', TMP_DiceBot_rollDiceAddingUp_20 = function $$rollDiceAddingUp($a_rest) {
      var $b, self = this, arg;

      var $args_len = arguments.length, $rest_len = $args_len - 0;
      if ($rest_len < 0) { $rest_len = 0; }
      arg = new Array($rest_len);
      for (var $arg_idx = 0; $arg_idx < $args_len; $arg_idx++) {
        arg[$arg_idx - 0] = arguments[$arg_idx];
      }
      return $send((($b = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $b), 'rollDiceAddingUp', Opal.to_a(arg))
    }, TMP_DiceBot_rollDiceAddingUp_20.$$arity = -1);
    
    Opal.defn(self, '$getHelpMessage', TMP_DiceBot_getHelpMessage_21 = function $$getHelpMessage() {
      var self = this;

      return ""
    }, TMP_DiceBot_getHelpMessage_21.$$arity = 0);
    
    Opal.defn(self, '$parren_killer', TMP_DiceBot_parren_killer_22 = function $$parren_killer(string) {
      var $a, self = this;

      return (($a = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $a).$parren_killer(string)
    }, TMP_DiceBot_parren_killer_22.$$arity = 1);
    
    Opal.defn(self, '$changeText', TMP_DiceBot_changeText_23 = function $$changeText(string) {
      var self = this;

      
      self.$debug("DiceBot.parren_killer_add called");
      return string;
    }, TMP_DiceBot_changeText_23.$$arity = 1);
    
    Opal.defn(self, '$dice_command', TMP_DiceBot_dice_command_24 = function $$dice_command(string, nick_e) {
      var $a, $b, self = this, secret_flg = nil, secretMarker = nil, command = nil, output_msg = nil;

      
      if ($truthy(self.$isGetOriginalMessage())) {
        string = (($a = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $a).$getOriginalMessage()};
      self.$debug("dice_command Begin string", string);
      secret_flg = false;
      if ($truthy(self.$class().$prefixesPattern()['$=~'](string))) {
        } else {
        
        self.$debug("not match in prefixes");
        return ["1", secret_flg];
      };
      secretMarker = Opal.const_get_relative($nesting, 'Regexp').$last_match(2);
      command = Opal.const_get_relative($nesting, 'Regexp').$last_match(3);
      command = self.$removeDiceCommandMessage(command);
      self.$debug("dicebot after command", command);
      self.$debug("match");
      $b = self.$rollDiceCommandCatched(command), $a = Opal.to_ary($b), (output_msg = ($a[0] == null ? nil : $a[0])), (secret_flg = ($a[1] == null ? nil : $a[1])), $b;
      if ($truthy(($truthy($a = output_msg['$nil?']()) ? $a : output_msg['$empty?']()))) {
        output_msg = "1"};
      secret_flg = ($truthy($a = secret_flg) ? $a : false);
      if ($truthy(output_msg['$!=']("1"))) {
        output_msg = "" + (nick_e) + ": " + (output_msg)};
      if ($truthy(secretMarker)) {
        if ($truthy(output_msg['$!=']("1"))) {
          secret_flg = true}};
      return [output_msg, secret_flg];
    }, TMP_DiceBot_dice_command_24.$$arity = 2);
    
    Opal.defn(self, '$isGetOriginalMessage', TMP_DiceBot_isGetOriginalMessage_25 = function $$isGetOriginalMessage() {
      var self = this;

      return false
    }, TMP_DiceBot_isGetOriginalMessage_25.$$arity = 0);
    
    Opal.defn(self, '$removeDiceCommandMessage', TMP_DiceBot_removeDiceCommandMessage_26 = function $$removeDiceCommandMessage(command) {
      var self = this;

      return command.$sub(/[\s　].+/, "")
    }, TMP_DiceBot_removeDiceCommandMessage_26.$$arity = 1);
    
    Opal.defn(self, '$rollDiceCommandCatched', TMP_DiceBot_rollDiceCommandCatched_27 = function $$rollDiceCommandCatched(command) {
      var $a, $b, self = this, result = nil, secret_flg = nil, e = nil;

      
      result = nil;
      
      try {
        
        self.$debug("call rollDiceCommand command", command);
        $b = self.$rollDiceCommand(command), $a = Opal.to_ary($b), (result = ($a[0] == null ? nil : $a[0])), (secret_flg = ($a[1] == null ? nil : $a[1])), $b;
      } catch ($err) {
        if (Opal.rescue($err, [Opal.const_get_relative($nesting, 'StandardError')])) {e = $err;
          try {
            self.$debug("executeCommand exception", e.$to_s(), e.$backtrace().$join("\n"))
          } finally { Opal.pop_exception() }
        } else { throw $err; }
      };;
      self.$debug("rollDiceCommand result", result);
      return [result, secret_flg];
    }, TMP_DiceBot_rollDiceCommandCatched_27.$$arity = 1);
    
    Opal.defn(self, '$rollDiceCommand', TMP_DiceBot_rollDiceCommand_28 = function $$rollDiceCommand(_command) {
      var self = this;

      return nil
    }, TMP_DiceBot_rollDiceCommand_28.$$arity = 1);
    
    Opal.defn(self, '$setDiceText', TMP_DiceBot_setDiceText_29 = function $$setDiceText(diceText) {
      var self = this;

      
      self.$debug("setDiceText diceText", diceText);
      return (self.diceText = diceText);
    }, TMP_DiceBot_setDiceText_29.$$arity = 1);
    
    Opal.defn(self, '$setDiffText', TMP_DiceBot_setDiffText_30 = function $$setDiffText(diffText) {
      var self = this;

      return (self.diffText = diffText)
    }, TMP_DiceBot_setDiffText_30.$$arity = 1);
    
    Opal.defn(self, '$dice_command_xRn', TMP_DiceBot_dice_command_xRn_31 = function $$dice_command_xRn(_string, _nick_e) {
      var self = this;

      return ""
    }, TMP_DiceBot_dice_command_xRn_31.$$arity = 2);
    
    Opal.defn(self, '$check_2D6', TMP_DiceBot_check_2D6_32 = function $$check_2D6(_total_n, _dice_n, _signOfInequality, _diff, _dice_cnt, _dice_max, _n1, _n_max) {
      var self = this;

      return ""
    }, TMP_DiceBot_check_2D6_32.$$arity = 8);
    
    Opal.defn(self, '$check_nD6', TMP_DiceBot_check_nD6_33 = function $$check_nD6(_total_n, _dice_n, _signOfInequality, _diff, _dice_cnt, _dice_max, _n1, _n_max) {
      var self = this;

      return ""
    }, TMP_DiceBot_check_nD6_33.$$arity = 8);
    
    Opal.defn(self, '$check_nD10', TMP_DiceBot_check_nD10_34 = function $$check_nD10(_total_n, _dice_n, _signOfInequality, _diff, _dice_cnt, _dice_max, _n1, _n_max) {
      var self = this;

      return ""
    }, TMP_DiceBot_check_nD10_34.$$arity = 8);
    
    Opal.defn(self, '$check_1D100', TMP_DiceBot_check_1D100_35 = function $$check_1D100(_total_n, _dice_n, _signOfInequality, _diff, _dice_cnt, _dice_max, _n1, _n_max) {
      var self = this;

      return ""
    }, TMP_DiceBot_check_1D100_35.$$arity = 8);
    
    Opal.defn(self, '$check_1D20', TMP_DiceBot_check_1D20_36 = function $$check_1D20(_total_n, _dice_n, _signOfInequality, _diff, _dice_cnt, _dice_max, _n1, _n_max) {
      var self = this;

      return ""
    }, TMP_DiceBot_check_1D20_36.$$arity = 8);
    
    Opal.defn(self, '$get_table_by_2d6', TMP_DiceBot_get_table_by_2d6_37 = function $$get_table_by_2d6(table) {
      var self = this;

      return self.$get_table_by_nD6(table, 2)
    }, TMP_DiceBot_get_table_by_2d6_37.$$arity = 1);
    
    Opal.defn(self, '$get_table_by_1d6', TMP_DiceBot_get_table_by_1d6_38 = function $$get_table_by_1d6(table) {
      var self = this;

      return self.$get_table_by_nD6(table, 1)
    }, TMP_DiceBot_get_table_by_1d6_38.$$arity = 1);
    
    Opal.defn(self, '$get_table_by_nD6', TMP_DiceBot_get_table_by_nD6_39 = function $$get_table_by_nD6(table, count) {
      var self = this;

      return self.$get_table_by_nDx(table, count, 6)
    }, TMP_DiceBot_get_table_by_nD6_39.$$arity = 2);
    
    Opal.defn(self, '$get_table_by_nDx', TMP_DiceBot_get_table_by_nDx_40 = function $$get_table_by_nDx(table, count, diceType) {
      var $a, $b, self = this, num = nil, text = nil;

      
      $b = self.$roll(count, diceType), $a = Opal.to_ary($b), (num = ($a[0] == null ? nil : $a[0])), $b;
      text = self.$getTableValue(table['$[]']($rb_minus(num, count)));
      if ($truthy(text['$nil?']())) {
        return ["1", 0]};
      return [text, num];
    }, TMP_DiceBot_get_table_by_nDx_40.$$arity = 3);
    
    Opal.defn(self, '$get_table_by_1d3', TMP_DiceBot_get_table_by_1d3_41 = function $$get_table_by_1d3(table) {
      var $a, $b, self = this, count = nil, num = nil, index = nil, text = nil;

      
      self.$debug("get_table_by_1d3");
      count = 1;
      $b = self.$roll(count, 6), $a = Opal.to_ary($b), (num = ($a[0] == null ? nil : $a[0])), $b;
      self.$debug("num", num);
      index = $rb_divide($rb_minus(num, 1), 2);
      self.$debug("index", index);
      text = table['$[]'](index);
      if ($truthy(text['$nil?']())) {
        return ["1", 0]};
      return [text, num];
    }, TMP_DiceBot_get_table_by_1d3_41.$$arity = 1);
    
    Opal.defn(self, '$getD66', TMP_DiceBot_getD66_42 = function $$getD66(isSwap) {
      var self = this;

      return self.$bcdice().$getD66(isSwap)
    }, TMP_DiceBot_getD66_42.$$arity = 1);
    
    Opal.defn(self, '$get_table_by_d66_swap', TMP_DiceBot_get_table_by_d66_swap_43 = function $$get_table_by_d66_swap(table) {
      var self = this, isSwap = nil, number = nil;

      
      isSwap = true;
      number = self.$bcdice().$getD66(isSwap);
      return [self.$get_table_by_number(number, table), number];
    }, TMP_DiceBot_get_table_by_d66_swap_43.$$arity = 1);
    
    Opal.defn(self, '$get_table_by_d66', TMP_DiceBot_get_table_by_d66_44 = function $$get_table_by_d66(table) {
      var $a, $b, self = this, dice1 = nil, dice2 = nil, num = nil, text = nil, indexText = nil;

      
      $b = self.$roll(1, 6), $a = Opal.to_ary($b), (dice1 = ($a[0] == null ? nil : $a[0])), $b;
      $b = self.$roll(1, 6), $a = Opal.to_ary($b), (dice2 = ($a[0] == null ? nil : $a[0])), $b;
      num = $rb_plus($rb_times($rb_minus(dice1, 1), 6), $rb_minus(dice2, 1));
      text = table['$[]'](num);
      indexText = "" + (dice1) + (dice2);
      if ($truthy(text['$nil?']())) {
        return ["1", indexText]};
      return [text, indexText];
    }, TMP_DiceBot_get_table_by_d66_44.$$arity = 1);
    
    Opal.defn(self, '$getDiceRolledAdditionalText', TMP_DiceBot_getDiceRolledAdditionalText_45 = function $$getDiceRolledAdditionalText(_n1, _n_max, _dice_max) {
      var self = this;

      return ""
    }, TMP_DiceBot_getDiceRolledAdditionalText_45.$$arity = 3);
    
    Opal.defn(self, '$getDiceRevision', TMP_DiceBot_getDiceRevision_46 = function $$getDiceRevision(_n_max, _dice_max, _total_n) {
      var self = this;

      return ["", 0]
    }, TMP_DiceBot_getDiceRevision_46.$$arity = 3);
    
    Opal.defn(self, '$changeDiceValueByDiceText', TMP_DiceBot_changeDiceValueByDiceText_47 = function $$changeDiceValueByDiceText(dice_now, _dice_str, _isCheckSuccess, _dice_max) {
      var self = this;

      return dice_now
    }, TMP_DiceBot_changeDiceValueByDiceText_47.$$arity = 4);
    
    Opal.defn(self, '$setRatingTable', TMP_DiceBot_setRatingTable_48 = function $$setRatingTable(_nick_e, _tnick, _channel_to_list) {
      var self = this;

      return "1"
    }, TMP_DiceBot_setRatingTable_48.$$arity = 3);
    
    Opal.defn(self, '$isD9', TMP_DiceBot_isD9_49 = function $$isD9() {
      var self = this;

      return false
    }, TMP_DiceBot_isD9_49.$$arity = 0);
    
    Opal.defn(self, '$getGrichText', TMP_DiceBot_getGrichText_50 = function $$getGrichText(_numberSpot1, _dice_cnt_total, _suc) {
      var self = this;

      return ""
    }, TMP_DiceBot_getGrichText_50.$$arity = 3);
    
    Opal.defn(self, '$check2dCritical', TMP_DiceBot_check2dCritical_51 = function $$check2dCritical(critical, dice_new, dice_arry, loop_count) {
      var self = this;

      return nil
    }, TMP_DiceBot_check2dCritical_51.$$arity = 4);
    
    Opal.defn(self, '$is2dCritical', TMP_DiceBot_is2dCritical_52 = function $$is2dCritical() {
      var self = this;

      return false
    }, TMP_DiceBot_is2dCritical_52.$$arity = 0);
    
    Opal.defn(self, '$should_reroll?', TMP_DiceBot_should_reroll$q_53 = function(loop_count) {
      var $a, self = this;

      return ($truthy($a = $rb_lt(loop_count, self.rerollLimitCount)) ? $a : self.rerollLimitCount['$=='](0))
    }, TMP_DiceBot_should_reroll$q_53.$$arity = 1);
    
    Opal.defn(self, '$getDiceList', TMP_DiceBot_getDiceList_54 = function $$getDiceList() {
      var self = this;

      return self.$getDiceListFromDiceText(self.diceText)
    }, TMP_DiceBot_getDiceList_54.$$arity = 0);
    
    Opal.defn(self, '$getDiceListFromDiceText', TMP_DiceBot_getDiceListFromDiceText_56 = function $$getDiceListFromDiceText(diceText) {
      var TMP_55, self = this, diceList = nil, diceString = nil;

      
      self.$debug("getDiceList diceText", diceText);
      diceList = [];
      if ($truthy(/\[([\d,]+)\]/['$=~'](diceText))) {
        diceText = Opal.const_get_relative($nesting, 'Regexp').$last_match(1)};
      if ($truthy(/([\d,]+)/['$=~'](diceText))) {
        } else {
        return diceList
      };
      diceString = Opal.const_get_relative($nesting, 'Regexp').$last_match(1);
      diceList = $send(diceString.$split(/,/), 'collect', [], (TMP_55 = function(i){var self = TMP_55.$$s || this;
if (i == null) i = nil;
      return i.$to_i()}, TMP_55.$$s = self, TMP_55.$$arity = 1, TMP_55));
      self.$debug("diceList", diceList);
      return diceList;
    }, TMP_DiceBot_getDiceListFromDiceText_56.$$arity = 1);
    
    Opal.defn(self, '$get_table_by_number', TMP_DiceBot_get_table_by_number_58 = function $$get_table_by_number(index, table, default$) {try {

      var TMP_57, self = this;

      if (default$ == null) {
        default$ = "1";
      }
      
      $send(table, 'each', [], (TMP_57 = function(item){var self = TMP_57.$$s || this, number = nil;
if (item == null) item = nil;
      
        number = item['$[]'](0);
        if ($truthy($rb_ge(number, index))) {
          Opal.ret(self.$getTableValue(item['$[]'](1)))
          } else {
          return nil
        };}, TMP_57.$$s = self, TMP_57.$$arity = 1, TMP_57));
      return self.$getTableValue(default$);
      } catch ($returner) { if ($returner === Opal.returner) { return $returner.$v } throw $returner; }
    }, TMP_DiceBot_get_table_by_number_58.$$arity = -3);
    
    Opal.defn(self, '$getTableValue', TMP_DiceBot_getTableValue_60 = function $$getTableValue(data) {try {

      var TMP_59, self = this, lambdaBlock = nil;

      
      if ($truthy(data['$kind_of?'](Opal.const_get_relative($nesting, 'Proc')))) {
        
        lambdaBlock = $send(self, 'lambda', [], (TMP_59 = function(){var self = TMP_59.$$s || this;

        Opal.ret(data.$call())}, TMP_59.$$s = self, TMP_59.$$arity = 0, TMP_59));
        return lambdaBlock.$call();};
      return data;
      } catch ($returner) { if ($returner === Opal.returner) { return $returner.$v } throw $returner; }
    }, TMP_DiceBot_getTableValue_60.$$arity = 1);
    
    Opal.defn(self, '$analyzeDiceCommandResultMethod', TMP_DiceBot_analyzeDiceCommandResultMethod_63 = function $$analyzeDiceCommandResultMethod(command) {try {

      var TMP_61, TMP_62, self = this, methodList = nil;

      
      methodList = $send(self.$public_methods(), 'select', [], (TMP_61 = function(method){var self = TMP_61.$$s || this;
if (method == null) method = nil;
      return /^get.+DiceCommandResult$/['$==='](method.$to_s())}, TMP_61.$$s = self, TMP_61.$$arity = 1, TMP_61));
      $send(methodList, 'each', [], (TMP_62 = function(method){var self = TMP_62.$$s || this, result = nil;
if (method == null) method = nil;
      
        result = self.$send(method, command);
        if ($truthy(result['$nil?']())) {
          return nil
          } else {
          Opal.ret(result)
        };}, TMP_62.$$s = self, TMP_62.$$arity = 1, TMP_62));
      return nil;
      } catch ($returner) { if ($returner === Opal.returner) { return $returner.$v } throw $returner; }
    }, TMP_DiceBot_analyzeDiceCommandResultMethod_63.$$arity = 1);
    
    Opal.defn(self, '$get_table_by_nDx_extratable', TMP_DiceBot_get_table_by_nDx_extratable_64 = function $$get_table_by_nDx_extratable(table, count, diceType) {
      var $a, $b, self = this, number = nil, diceText = nil, text = nil;

      
      $b = self.$roll(count, diceType), $a = Opal.to_ary($b), (number = ($a[0] == null ? nil : $a[0])), (diceText = ($a[1] == null ? nil : $a[1])), $b;
      text = self.$getTableValue(table['$[]']($rb_minus(number, count)));
      return [text, number, diceText];
    }, TMP_DiceBot_get_table_by_nDx_extratable_64.$$arity = 3);
    
    Opal.defn(self, '$getTableCommandResult', TMP_DiceBot_getTableCommandResult_65 = function $$getTableCommandResult(command, tables, isPrintDiceText) {
      var $a, $b, $c, $d, self = this, info = nil, name = nil, type = nil, table = nil, $case = nil, count = nil, diceType = nil, limit = nil, item = nil, value = nil, output = nil, diceText = nil, text = nil, number = nil;

      if (isPrintDiceText == null) {
        isPrintDiceText = true;
      }
      
      info = tables['$[]'](command.$upcase());
      if ($truthy(info['$nil?']())) {
        return nil};
      name = info['$[]']("name");
      type = info['$[]']("type").$upcase();
      table = info['$[]']("table");
      if ($truthy(($truthy($a = type['$==']("D66")) ? self.d66Type['$=='](2) : $a))) {
        type = "D66S"};
      $b = (function() {$case = type;
      if (/(\d+)D(\d+)/['$===']($case)) {
      count = Opal.const_get_relative($nesting, 'Regexp').$last_match(1).$to_i();
      diceType = Opal.const_get_relative($nesting, 'Regexp').$last_match(2).$to_i();
      limit = $rb_minus($rb_times(diceType, count), $rb_minus(count, 1));
      table = self.$getTableInfoFromExtraTableText(table, limit);
      return self.$get_table_by_nDx_extratable(table, count, diceType);}
      else if ("D66"['$===']($case) || "D66N"['$===']($case)) {
      table = self.$getTableInfoFromExtraTableText(table, 36);
      $d = self.$get_table_by_d66(table), $c = Opal.to_ary($d), (item = ($c[0] == null ? nil : $c[0])), (value = ($c[1] == null ? nil : $c[1])), $d;
      value = value.$to_i();
      output = item['$[]'](1);
      diceText = $rb_plus($rb_plus($rb_divide(value, 10).$floor().$to_s(), ","), value['$%'](10).$to_s());
      return [output, value, diceText];}
      else if ("D66S"['$===']($case)) {
      table = self.$getTableInfoFromExtraTableText(table, 21);
      $d = self.$get_table_by_d66_swap(table), $c = Opal.to_ary($d), (output = ($c[0] == null ? nil : $c[0])), (value = ($c[1] == null ? nil : $c[1])), $d;
      value = value.$to_i();
      diceText = $rb_plus($rb_plus($rb_divide(value, 10).$floor().$to_s(), ","), value['$%'](10).$to_s());
      return [output, value, diceText];}
      else {return self.$raise("" + "invalid dice Type " + (command))}})(), $a = Opal.to_ary($b), (text = ($a[0] == null ? nil : $a[0])), (number = ($a[1] == null ? nil : $a[1])), (diceText = ($a[2] == null ? nil : $a[2])), $b;
      text = text.$gsub("\\n", "\n");
      text = (($a = $DiceBot.$$cvars['@@bcdice']) == null ? nil : $a).$rollTableMessageDiceText(text);
      if ($truthy(text['$nil?']())) {
        return nil};
      if ($truthy(($truthy($a = isPrintDiceText) ? diceText['$nil?']()['$!']() : $a))) {
        return "" + (name) + "(" + (number) + "[" + (diceText) + "]) ＞ " + (text)};
      return "" + (name) + "(" + (number) + ") ＞ " + (text);
    }, TMP_DiceBot_getTableCommandResult_65.$$arity = -3);
    
    Opal.defn(self, '$getTableInfoFromExtraTableText', TMP_DiceBot_getTableInfoFromExtraTableText_67 = function $$getTableInfoFromExtraTableText(text, count) {
      var TMP_66, self = this, newTable = nil;

      if (count == null) {
        count = nil;
      }
      
      if ($truthy(text['$is_a?'](Opal.const_get_relative($nesting, 'String')))) {
        text = text.$split(/\n/)};
      newTable = $send(text, 'map', [], (TMP_66 = function(item){var self = TMP_66.$$s || this, $a;
if (item == null) item = nil;
      if ($truthy(($truthy($a = item['$is_a?'](Opal.const_get_relative($nesting, 'String'))) ? /^(\d+):(.*)/['$==='](item) : $a))) {
          return [Opal.const_get_relative($nesting, 'Regexp').$last_match(1).$to_i(), Opal.const_get_relative($nesting, 'Regexp').$last_match(2)]
          } else {
          return item
        }}, TMP_66.$$s = self, TMP_66.$$arity = 1, TMP_66));
      if ($truthy(count['$nil?']())) {
      } else if ($truthy(newTable.$size()['$!='](count))) {
        self.$raise("" + "invalid table size:" + (newTable.$size()) + "\n" + (newTable.$inspect()))};
      return newTable;
    }, TMP_DiceBot_getTableInfoFromExtraTableText_67.$$arity = -2);
    return (Opal.defn(self, '$roll_tables', TMP_DiceBot_roll_tables_68 = function $$roll_tables(command, tables) {
      var self = this, table = nil;

      
      table = tables['$[]'](command.$upcase());
      if ($truthy(table)) {
        } else {
        return nil
      };
      return table.$roll(self.$bcdice());
    }, TMP_DiceBot_roll_tables_68.$$arity = 2), nil) && 'roll_tables';
  })($nesting[0], null, $nesting)
})(Opal);

/* Generated by Opal 0.11.4 */
(function(Opal) {
  var self = Opal.top, $nesting = [], nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice;

  Opal.add_stubs(['$exit']);
  return Opal.const_get_relative($nesting, 'Kernel').$exit()
})(Opal);
Opal.loaded(["diceBot/DiceBot"]);
/* Generated by Opal 0.11.4 */
Opal.modules["utils/ArithmeticEvaluator"] = function(Opal) {
  function $rb_plus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);
  }
  function $rb_minus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);
  }
  function $rb_times(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs * rhs : lhs['$*'](rhs);
  }
  function $rb_divide(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs / rhs : lhs['$/'](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice, $klass = Opal.klass, $truthy = Opal.truthy, $send = Opal.send;

  Opal.add_stubs(['$tokenize', '$expr', '$private', '$split', '$gsub', '$mul', '$loop', '$consume', '$+', '$-', '$unary', '$*', '$div', '$zero?', '$===', '$ceil', '$/', '$to_f', '$round', '$floor', '$-@', '$term', '$expect', '$expect_number', '$!=', '$[]', '$integer?', '$to_i', '$!', '$nil?', '$match']);
  return (function($base, $super, $parent_nesting) {
    function $ArithmeticEvaluator(){};
    var self = $ArithmeticEvaluator = $klass($base, $super, 'ArithmeticEvaluator', $ArithmeticEvaluator);

    var def = self.$$proto, $nesting = [self].concat($parent_nesting), TMP_ArithmeticEvaluator_eval_1, TMP_ArithmeticEvaluator_tokenize_3, TMP_ArithmeticEvaluator_add_5, TMP_ArithmeticEvaluator_mul_7, TMP_ArithmeticEvaluator_div_8, TMP_ArithmeticEvaluator_unary_9, TMP_ArithmeticEvaluator_term_10, TMP_ArithmeticEvaluator_consume_11, TMP_ArithmeticEvaluator_expect_12, TMP_ArithmeticEvaluator_expect_number_13, TMP_ArithmeticEvaluator_integer$q_14;

    def.error = def.round_type = def.tokens = def.idx = nil;
    
    
    Opal.defn(self, '$eval', TMP_ArithmeticEvaluator_eval_1 = function(expr, round_type) {
      var self = this, ret = nil;

      if (round_type == null) {
        round_type = "omit";
      }
      
      self.tokens = self.$tokenize(expr);
      self.idx = 0;
      self.error = false;
      self.round_type = round_type;
      ret = self.$expr();
      if ($truthy(self.error)) {
        return 0
        } else {
        return ret
      };
    }, TMP_ArithmeticEvaluator_eval_1.$$arity = -2);
    self.$private();
    
    Opal.defn(self, '$tokenize', TMP_ArithmeticEvaluator_tokenize_3 = function $$tokenize(expr) {
      var TMP_2, self = this;

      return $send(expr, 'gsub', [/[\(\)\+\-\*\/]/], (TMP_2 = function(e){var self = TMP_2.$$s || this;
if (e == null) e = nil;
      return "" + " " + (e) + " "}, TMP_2.$$s = self, TMP_2.$$arity = 1, TMP_2)).$split(" ")
    }, TMP_ArithmeticEvaluator_tokenize_3.$$arity = 1);
    
    Opal.defn(self, '$add', TMP_ArithmeticEvaluator_add_5 = function $$add() {
      var TMP_4, self = this, ret = nil;

      
      ret = self.$mul();
      (function(){var $brk = Opal.new_brk(); try {return $send(self, 'loop', [], (TMP_4 = function(){var self = TMP_4.$$s || this;

      if ($truthy(self.$consume("+"))) {
          return (ret = $rb_plus(ret, self.$mul()))
        } else if ($truthy(self.$consume("-"))) {
          return (ret = $rb_minus(ret, self.$mul()))
          } else {
          
          Opal.brk(nil, $brk)
        }}, TMP_4.$$s = self, TMP_4.$$brk = $brk, TMP_4.$$arity = 0, TMP_4))
      } catch (err) { if (err === $brk) { return err.$v } else { throw err } }})();
      return ret;
    }, TMP_ArithmeticEvaluator_add_5.$$arity = 0);
    Opal.alias(self, "expr", "add");
    
    Opal.defn(self, '$mul', TMP_ArithmeticEvaluator_mul_7 = function $$mul() {
      var TMP_6, self = this, ret = nil;

      
      ret = self.$unary();
      (function(){var $brk = Opal.new_brk(); try {return $send(self, 'loop', [], (TMP_6 = function(){var self = TMP_6.$$s || this;

      if ($truthy(self.$consume("*"))) {
          return (ret = $rb_times(ret, self.$unary()))
        } else if ($truthy(self.$consume("/"))) {
          return (ret = self.$div(ret, self.$unary()))
          } else {
          
          Opal.brk(nil, $brk)
        }}, TMP_6.$$s = self, TMP_6.$$brk = $brk, TMP_6.$$arity = 0, TMP_6))
      } catch (err) { if (err === $brk) { return err.$v } else { throw err } }})();
      return ret;
    }, TMP_ArithmeticEvaluator_mul_7.$$arity = 0);
    
    Opal.defn(self, '$div', TMP_ArithmeticEvaluator_div_8 = function $$div(left, right) {
      var self = this, $case = nil;

      
      if ($truthy(right['$zero?']())) {
        
        self.error = true;
        return 0;};
      return (function() {$case = self.round_type;
      if ("roundUp"['$===']($case)) {return $rb_divide(left.$to_f(), right).$ceil()}
      else if ("roundOff"['$===']($case)) {return $rb_divide(left.$to_f(), right).$round()}
      else {return $rb_divide(left, right).$floor()}})();
    }, TMP_ArithmeticEvaluator_div_8.$$arity = 2);
    
    Opal.defn(self, '$unary', TMP_ArithmeticEvaluator_unary_9 = function $$unary() {
      var self = this;

      if ($truthy(self.$consume("+"))) {
        return self.$unary()
      } else if ($truthy(self.$consume("-"))) {
        return self.$unary()['$-@']()
        } else {
        return self.$term()
      }
    }, TMP_ArithmeticEvaluator_unary_9.$$arity = 0);
    
    Opal.defn(self, '$term', TMP_ArithmeticEvaluator_term_10 = function $$term() {
      var self = this, ret = nil;

      if ($truthy(self.$consume("("))) {
        
        ret = self.$expr();
        self.$expect(")");
        return ret;
        } else {
        return self.$expect_number()
      }
    }, TMP_ArithmeticEvaluator_term_10.$$arity = 0);
    
    Opal.defn(self, '$consume', TMP_ArithmeticEvaluator_consume_11 = function $$consume(str) {
      var self = this;

      
      if ($truthy(self.tokens['$[]'](self.idx)['$!='](str))) {
        return false};
      self.idx = $rb_plus(self.idx, 1);
      return true;
    }, TMP_ArithmeticEvaluator_consume_11.$$arity = 1);
    
    Opal.defn(self, '$expect', TMP_ArithmeticEvaluator_expect_12 = function $$expect(str) {
      var self = this;

      
      if ($truthy(self.tokens['$[]'](self.idx)['$!='](str))) {
        self.error = true};
      return (self.idx = $rb_plus(self.idx, 1));
    }, TMP_ArithmeticEvaluator_expect_12.$$arity = 1);
    
    Opal.defn(self, '$expect_number', TMP_ArithmeticEvaluator_expect_number_13 = function $$expect_number() {
      var self = this, ret = nil;

      
      if ($truthy(self['$integer?'](self.tokens['$[]'](self.idx)))) {
        } else {
        
        self.error = true;
        self.idx = $rb_plus(self.idx, 1);
        return 0;
      };
      ret = self.tokens['$[]'](self.idx).$to_i();
      self.idx = $rb_plus(self.idx, 1);
      return ret;
    }, TMP_ArithmeticEvaluator_expect_number_13.$$arity = 0);
    return (Opal.defn(self, '$integer?', TMP_ArithmeticEvaluator_integer$q_14 = function(str) {
      var self = this;

      return /^\d+$/.$match(str)['$nil?']()['$!']()
    }, TMP_ArithmeticEvaluator_integer$q_14.$$arity = 1), nil) && 'integer?';
  })($nesting[0], null, $nesting)
};

/* Generated by Opal 0.11.4 */
(function(Opal) {
  function $rb_gt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);
  }
  function $rb_ge(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs >= rhs : lhs['$>='](rhs);
  }
  function $rb_plus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);
  }
  function $rb_lt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs < rhs : lhs['$<'](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice, $klass = Opal.klass, $send = Opal.send, $truthy = Opal.truthy, $gvars = Opal.gvars;

  Opal.add_stubs(['$require', '$setPrefixes', '$freeze', '$new', '$num', '$critical_value', '$formatted_modifier', '$target_value', '$==', '$modifier', '$>', '$to_s', '$attr_reader', '$sort', '$max', '$join', '$any?', '$critical?', '$length', '$select', '$private', '$>=', '$all?', '$values', '$[]', '$reduce', '$map', '$to_proc', '$+', '$to_s_long', '$to_s_short', '$achieved_value_with_if_fumble', '$compare_result', '$compact', '$parse', '$execute_dx', '$get_emotion_table', '$===', '$parse_dx_od', '$last_match', '$parse_dx_shippu_doto', '$to_i', '$eval', '$<', '$should_reroll?', '$roll', '$push', '$num_of_critical_occurrences', '$dx_feel_positive_table', '$dx_feel_negative_table', '$!=', '$dx_feel_table', '$get_table_by_number']);
  
  self.$require("diceBot/DiceBot");
  self.$require("utils/ArithmeticEvaluator");
  return (function($base, $super, $parent_nesting) {
    function $DoubleCross(){};
    var self = $DoubleCross = $klass($base, $super, 'DoubleCross', $DoubleCross);

    var def = self.$$proto, $nesting = [self].concat($parent_nesting), TMP_DoubleCross_initialize_1, TMP_DoubleCross_gameName_2, TMP_DoubleCross_gameType_3, TMP_DoubleCross_getHelpMessage_4, TMP_DoubleCross_5, TMP_DoubleCross_check_nD10_22, TMP_DoubleCross_rollDiceCommand_23, TMP_DoubleCross_parse_24, TMP_DoubleCross_parse_dx_od_25, TMP_DoubleCross_parse_dx_shippu_doto_26, TMP_DoubleCross_execute_dx_28, TMP_DoubleCross_get_emotion_table_29, TMP_DoubleCross_dx_feel_positive_table_30, TMP_DoubleCross_dx_feel_negative_table_31, TMP_DoubleCross_dx_feel_table_32;

    
    self.$setPrefixes(["\\d+DX.*", "ET"]);
    
    Opal.defn(self, '$initialize', TMP_DoubleCross_initialize_1 = function $$initialize() {
      var self = this, $iter = TMP_DoubleCross_initialize_1.$$p, $yield = $iter || nil, $zuper = nil, $zuper_i = nil, $zuper_ii = nil;

      if ($iter) TMP_DoubleCross_initialize_1.$$p = null;
      // Prepare super implicit arguments
      for($zuper_i = 0, $zuper_ii = arguments.length, $zuper = new Array($zuper_ii); $zuper_i < $zuper_ii; $zuper_i++) {
        $zuper[$zuper_i] = arguments[$zuper_i];
      }
      return $send(self, Opal.find_super_dispatcher(self, 'initialize', TMP_DoubleCross_initialize_1, false), $zuper, $iter)
    }, TMP_DoubleCross_initialize_1.$$arity = 0);
    
    Opal.defn(self, '$gameName', TMP_DoubleCross_gameName_2 = function $$gameName() {
      var self = this;

      return "ダブルクロス2nd,3rd"
    }, TMP_DoubleCross_gameName_2.$$arity = 0);
    
    Opal.defn(self, '$gameType', TMP_DoubleCross_gameType_3 = function $$gameType() {
      var self = this;

      return "DoubleCross"
    }, TMP_DoubleCross_gameType_3.$$arity = 0);
    
    Opal.defn(self, '$getHelpMessage', TMP_DoubleCross_getHelpMessage_4 = function $$getHelpMessage() {
      var self = this;

      return "" + "・判定コマンド　(xDX+y@c or xDXc+y)\n" + "　\"(個数)DX(修正)@(クリティカル値)\"もしくは\"(個数)DX(クリティカル値)(修正)\"で指定します。\n" + "　加算減算のみ修正値も付けられます。\n" + "　例）10dx　　　10dx+5@8(OD tool式)　　　5DX7+7-3(疾風怒濤式)\n" + "\n" + "・各種表\n" + "　・感情表(ET)\n" + "　　ポジティブとネガティブの両方を振って、表になっている側に○を付けて表示します。もちろん任意で選ぶ部分は変更して構いません。\n" + "\n" + "・D66ダイスあり\n"
    }, TMP_DoubleCross_getHelpMessage_4.$$arity = 0);
    Opal.const_set($nesting[0], 'DX_OD_TOLL_RE', /^(\d+)DX([-+][-+\d]+)?@(\d+)(?:>=(\d+))?$/i.$freeze());
    Opal.const_set($nesting[0], 'DX_SHIPPU_DOTO_RE', /^(\d+)DX(\d+)?([-+][-+\d]+)?(?:>=(\d+))?$/i.$freeze());
    Opal.const_set($nesting[0], 'DXNode', $send(Opal.const_get_relative($nesting, 'Struct'), 'new', ["num", "critical_value", "modifier", "target_value"], (TMP_DoubleCross_5 = function(){var self = TMP_DoubleCross_5.$$s || this, TMP_to_s_6, TMP_formatted_modifier_7;

    
      
      Opal.def(self, '$to_s', TMP_to_s_6 = function $$to_s() {
        var self = this, lhs = nil;

        
        lhs = "" + (self.$num()) + "DX" + (self.$critical_value()) + (self.$formatted_modifier());
        return (function() {if ($truthy(self.$target_value())) {
          return "" + (lhs) + ">=" + (self.$target_value())
          } else {
          return lhs
        }; return nil; })();
      }, TMP_to_s_6.$$arity = 0);
      return (Opal.def(self, '$formatted_modifier', TMP_formatted_modifier_7 = function $$formatted_modifier() {
        var self = this;

        if (self.$modifier()['$=='](0)) {
          return ""
        } else if ($truthy($rb_gt(self.$modifier(), 0))) {
          return "" + "+" + (self.$modifier())
          } else {
          return self.$modifier().$to_s()
        }
      }, TMP_formatted_modifier_7.$$arity = 0), nil) && 'formatted_modifier';}, TMP_DoubleCross_5.$$s = self, TMP_DoubleCross_5.$$arity = 0, TMP_DoubleCross_5)));
    (function($base, $super, $parent_nesting) {
      function $ValueGroup(){};
      var self = $ValueGroup = $klass($base, $super, 'ValueGroup', $ValueGroup);

      var def = self.$$proto, $nesting = [self].concat($parent_nesting), TMP_ValueGroup_initialize_8, TMP_ValueGroup_to_s_9, TMP_ValueGroup_max_11, TMP_ValueGroup_num_of_critical_occurrences_13, TMP_ValueGroup_critical$q_14;

      def.values = def.critical_value = nil;
      
      self.$attr_reader("values");
      self.$attr_reader("critical_value");
      
      Opal.defn(self, '$initialize', TMP_ValueGroup_initialize_8 = function $$initialize(values, critical_value) {
        var self = this;

        
        self.values = values.$sort();
        return (self.critical_value = critical_value);
      }, TMP_ValueGroup_initialize_8.$$arity = 2);
      
      Opal.defn(self, '$to_s', TMP_ValueGroup_to_s_9 = function $$to_s() {
        var self = this;

        return "" + (self.$max()) + "[" + (self.values.$join(",")) + "]"
      }, TMP_ValueGroup_to_s_9.$$arity = 0);
      
      Opal.defn(self, '$max', TMP_ValueGroup_max_11 = function $$max() {
        var TMP_10, self = this;

        if ($truthy($send(self.values, 'any?', [], (TMP_10 = function(value){var self = TMP_10.$$s || this;
if (value == null) value = nil;
        return self['$critical?'](value)}, TMP_10.$$s = self, TMP_10.$$arity = 1, TMP_10)))) {
          return 10
          } else {
          return self.values.$max()
        }
      }, TMP_ValueGroup_max_11.$$arity = 0);
      
      Opal.defn(self, '$num_of_critical_occurrences', TMP_ValueGroup_num_of_critical_occurrences_13 = function $$num_of_critical_occurrences() {
        var TMP_12, self = this;

        return $send(self.values, 'select', [], (TMP_12 = function(value){var self = TMP_12.$$s || this;
if (value == null) value = nil;
        return self['$critical?'](value)}, TMP_12.$$s = self, TMP_12.$$arity = 1, TMP_12)).$length()
      }, TMP_ValueGroup_num_of_critical_occurrences_13.$$arity = 0);
      self.$private();
      return (Opal.defn(self, '$critical?', TMP_ValueGroup_critical$q_14 = function(value) {
        var self = this;

        return $rb_ge(value, self.critical_value)
      }, TMP_ValueGroup_critical$q_14.$$arity = 1), nil) && 'critical?';
    })($nesting[0], null, $nesting);
    (function($base, $super, $parent_nesting) {
      function $DXDiceRollResult(){};
      var self = $DXDiceRollResult = $klass($base, $super, 'DXDiceRollResult', $DXDiceRollResult);

      var def = self.$$proto, $nesting = [self].concat($parent_nesting), TMP_DXDiceRollResult_initialize_16, TMP_DXDiceRollResult_to_s_17, TMP_DXDiceRollResult_to_s_long_18, TMP_DXDiceRollResult_to_s_short_19, TMP_DXDiceRollResult_achieved_value_with_if_fumble_20, TMP_DXDiceRollResult_compare_result_21;

      def.value_groups = def.is_fumble = def.dx_node = def.loop_count = def.achieved_value = nil;
      
      self.$attr_reader("dx_node");
      self.$attr_reader("value_groups");
      self.$attr_reader("loop_count");
      self.$attr_reader("achieved_value");
      self.$attr_reader("is_fumble");
      
      Opal.defn(self, '$initialize', TMP_DXDiceRollResult_initialize_16 = function $$initialize(dx_node, value_groups, loop_count) {
        var TMP_15, self = this, sum = nil;

        
        self.dx_node = dx_node;
        self.value_groups = value_groups;
        self.loop_count = loop_count;
        self.is_fumble = $send(self.value_groups['$[]'](0).$values(), 'all?', [], (TMP_15 = function(value){var self = TMP_15.$$s || this;
if (value == null) value = nil;
        return value['$=='](1)}, TMP_15.$$s = self, TMP_15.$$arity = 1, TMP_15));
        sum = $send(self.value_groups, 'map', [], "max".$to_proc()).$reduce(0, "+");
        return (self.achieved_value = (function() {if ($truthy(self.is_fumble)) {
          return 0
          } else {
          
          return $rb_plus(sum, self.dx_node.$modifier());
        }; return nil; })());
      }, TMP_DXDiceRollResult_initialize_16.$$arity = 3);
      
      Opal.defn(self, '$to_s', TMP_DXDiceRollResult_to_s_17 = function $$to_s() {
        var self = this, long_str = nil;
        if ($gvars.SEND_STR_MAX == null) $gvars.SEND_STR_MAX = nil;

        
        long_str = self.$to_s_long();
        return (function() {if ($truthy($rb_gt(long_str.$length(), $gvars.SEND_STR_MAX))) {
          return self.$to_s_short()
          } else {
          return long_str
        }; return nil; })();
      }, TMP_DXDiceRollResult_to_s_17.$$arity = 0);
      self.$private();
      
      Opal.defn(self, '$to_s_long', TMP_DXDiceRollResult_to_s_long_18 = function $$to_s_long() {
        var self = this, parts = nil;

        
        parts = ["" + "(" + (self.dx_node) + ")", "" + (self.value_groups.$join("+")) + (self.dx_node.$formatted_modifier()), self.$achieved_value_with_if_fumble(), self.$compare_result()];
        return parts.$compact().$join(" ＞ ");
      }, TMP_DXDiceRollResult_to_s_long_18.$$arity = 0);
      
      Opal.defn(self, '$to_s_short', TMP_DXDiceRollResult_to_s_short_19 = function $$to_s_short() {
        var self = this, parts = nil;

        
        parts = ["" + "(" + (self.dx_node) + ")", "...", "" + "回転数" + (self.loop_count), self.$achieved_value_with_if_fumble(), self.$compare_result()];
        return parts.$compact().$join(" ＞ ");
      }, TMP_DXDiceRollResult_to_s_short_19.$$arity = 0);
      
      Opal.defn(self, '$achieved_value_with_if_fumble', TMP_DXDiceRollResult_achieved_value_with_if_fumble_20 = function $$achieved_value_with_if_fumble() {
        var self = this;

        if ($truthy(self.is_fumble)) {
          return "" + (self.achieved_value) + " (ファンブル)"
          } else {
          return self.achieved_value.$to_s()
        }
      }, TMP_DXDiceRollResult_achieved_value_with_if_fumble_20.$$arity = 0);
      return (Opal.defn(self, '$compare_result', TMP_DXDiceRollResult_compare_result_21 = function $$compare_result() {
        var self = this;

        
        if ($truthy(self.dx_node.$target_value())) {
          } else {
          return nil
        };
        if ($truthy(self.is_fumble)) {
          return "失敗"};
        return (function() {if ($truthy($rb_ge(self.achieved_value, self.dx_node.$target_value()))) {
          return "成功"
          } else {
          return "失敗"
        }; return nil; })();
      }, TMP_DXDiceRollResult_compare_result_21.$$arity = 0), nil) && 'compare_result';
    })($nesting[0], null, $nesting);
    
    Opal.defn(self, '$check_nD10', TMP_DoubleCross_check_nD10_22 = function $$check_nD10(total_n, _dice_n, signOfInequality, diff, dice_cnt, _dice_max, n1, _n_max) {
      var self = this;

      
      if (signOfInequality['$=='](">=")) {
        } else {
        return ""
      };
      if ($truthy($rb_ge(n1, dice_cnt))) {
        return " ＞ ファンブル"
      } else if ($truthy($rb_ge(total_n, diff))) {
        return " ＞ 成功"
        } else {
        return " ＞ 失敗"
      };
    }, TMP_DoubleCross_check_nD10_22.$$arity = 8);
    
    Opal.defn(self, '$rollDiceCommand', TMP_DoubleCross_rollDiceCommand_23 = function $$rollDiceCommand(command) {
      var self = this, dx = nil;

      
      if ($truthy((dx = self.$parse(command)))) {
        return self.$execute_dx(dx)};
      if (command['$==']("ET")) {
        return self.$get_emotion_table()};
      return nil;
    }, TMP_DoubleCross_rollDiceCommand_23.$$arity = 1);
    self.$private();
    
    Opal.defn(self, '$parse', TMP_DoubleCross_parse_24 = function $$parse(command) {
      var self = this, $case = nil;

      
      $case = command;
      if (Opal.const_get_relative($nesting, 'DX_OD_TOLL_RE')['$===']($case)) {return self.$parse_dx_od(Opal.const_get_relative($nesting, 'Regexp').$last_match())}
      else if (Opal.const_get_relative($nesting, 'DX_SHIPPU_DOTO_RE')['$===']($case)) {return self.$parse_dx_shippu_doto(Opal.const_get_relative($nesting, 'Regexp').$last_match())};
      return nil;
    }, TMP_DoubleCross_parse_24.$$arity = 1);
    
    Opal.defn(self, '$parse_dx_od', TMP_DoubleCross_parse_dx_od_25 = function $$parse_dx_od(m) {
      var $a, self = this, num = nil, modifier = nil, critical_value = nil, target_value = nil;

      
      num = m['$[]'](1).$to_i();
      modifier = (function() {if ($truthy(m['$[]'](2))) {
        return Opal.const_get_relative($nesting, 'ArithmeticEvaluator').$new().$eval(m['$[]'](2))
        } else {
        return 0
      }; return nil; })();
      critical_value = (function() {if ($truthy(m['$[]'](3))) {
        return m['$[]'](3).$to_i()
        } else {
        return 10
      }; return nil; })();
      target_value = ($truthy($a = m['$[]'](4)) ? m['$[]'](4).$to_i() : $a);
      return Opal.const_get_relative($nesting, 'DXNode').$new(num, critical_value, modifier, target_value);
    }, TMP_DoubleCross_parse_dx_od_25.$$arity = 1);
    
    Opal.defn(self, '$parse_dx_shippu_doto', TMP_DoubleCross_parse_dx_shippu_doto_26 = function $$parse_dx_shippu_doto(m) {
      var $a, self = this, num = nil, critical_value = nil, modifier = nil, target_value = nil;

      
      num = m['$[]'](1).$to_i();
      critical_value = (function() {if ($truthy(m['$[]'](2))) {
        return m['$[]'](2).$to_i()
        } else {
        return 10
      }; return nil; })();
      modifier = (function() {if ($truthy(m['$[]'](3))) {
        return Opal.const_get_relative($nesting, 'ArithmeticEvaluator').$new().$eval(m['$[]'](3))
        } else {
        return 0
      }; return nil; })();
      target_value = ($truthy($a = m['$[]'](4)) ? m['$[]'](4).$to_i() : $a);
      return Opal.const_get_relative($nesting, 'DXNode').$new(num, critical_value, modifier, target_value);
    }, TMP_DoubleCross_parse_dx_shippu_doto_26.$$arity = 1);
    
    Opal.defn(self, '$execute_dx', TMP_DoubleCross_execute_dx_28 = function $$execute_dx(node) {
      var $a, $b, TMP_27, self = this, value_groups = nil, num_of_dice = nil, loop_count = nil, values = nil, value_group = nil;

      
      if ($truthy($rb_lt(node.$critical_value(), 2))) {
        return "" + "(" + (node) + ") ＞ クリティカル値が低すぎます。2以上を指定してください。"};
      if ($truthy($rb_lt(node.$num(), 1))) {
        return "" + "(" + (node) + ") ＞ 自動失敗"};
      value_groups = [];
      num_of_dice = node.$num();
      loop_count = 0;
      while ($truthy(($truthy($b = $rb_gt(num_of_dice, 0)) ? self['$should_reroll?'](loop_count) : $b))) {
        
        values = $send(Opal.const_get_relative($nesting, 'Array'), 'new', [num_of_dice], (TMP_27 = function(){var self = TMP_27.$$s || this;

        return self.$roll(1, 10)['$[]'](0)}, TMP_27.$$s = self, TMP_27.$$arity = 0, TMP_27));
        value_group = Opal.const_get_relative($nesting, 'ValueGroup').$new(values, node.$critical_value());
        value_groups.$push(value_group);
        num_of_dice = value_group.$num_of_critical_occurrences();
        loop_count = $rb_plus(loop_count, 1);
      };
      return Opal.const_get_relative($nesting, 'DXDiceRollResult').$new(node, value_groups, loop_count).$to_s();
    }, TMP_DoubleCross_execute_dx_28.$$arity = 1);
    
    Opal.defn(self, '$get_emotion_table', TMP_DoubleCross_get_emotion_table_29 = function $$get_emotion_table() {
      var $a, $b, self = this, output = nil, pos_dice = nil, pos_table = nil, neg_dice = nil, neg_table = nil, dice_now = nil;

      
      output = nil;
      $b = self.$dx_feel_positive_table(), $a = Opal.to_ary($b), (pos_dice = ($a[0] == null ? nil : $a[0])), (pos_table = ($a[1] == null ? nil : $a[1])), $b;
      $b = self.$dx_feel_negative_table(), $a = Opal.to_ary($b), (neg_dice = ($a[0] == null ? nil : $a[0])), (neg_table = ($a[1] == null ? nil : $a[1])), $b;
      $b = self.$roll(1, 2), $a = Opal.to_ary($b), (dice_now = ($a[0] == null ? nil : $a[0])), $b;
      if ($truthy(($truthy($a = pos_table['$!=']("1")) ? neg_table['$!=']("1") : $a))) {
        
        if ($truthy($rb_lt(dice_now, 2))) {
          pos_table = $rb_plus("○", pos_table)
          } else {
          neg_table = $rb_plus("○", neg_table)
        };
        output = "" + "感情表(" + (pos_dice) + "-" + (neg_dice) + ") ＞ " + (pos_table) + " - " + (neg_table);};
      return output;
    }, TMP_DoubleCross_get_emotion_table_29.$$arity = 0);
    
    Opal.defn(self, '$dx_feel_positive_table', TMP_DoubleCross_dx_feel_positive_table_30 = function $$dx_feel_positive_table() {
      var self = this, table = nil;

      
      table = [[0, "傾倒(けいとう)"], [5, "好奇心(こうきしん)"], [10, "憧憬(どうけい)"], [15, "尊敬(そんけい)"], [20, "連帯感(れんたいかん)"], [25, "慈愛(じあい)"], [30, "感服(かんぷく)"], [35, "純愛(じゅんあい)"], [40, "友情(ゆうじょう)"], [45, "慕情(ぼじょう)"], [50, "同情(どうじょう)"], [55, "遺志(いし)"], [60, "庇護(ひご)"], [65, "幸福感(こうふくかん)"], [70, "信頼(しんらい)"], [75, "執着(しゅうちゃく)"], [80, "親近感(しんきんかん)"], [85, "誠意(せいい)"], [90, "好意(こうい)"], [95, "有為(ゆうい)"], [100, "尽力(じんりょく)"], [101, "懐旧(かいきゅう)"], [102, "任意(にんい)"]];
      return self.$dx_feel_table(table);
    }, TMP_DoubleCross_dx_feel_positive_table_30.$$arity = 0);
    
    Opal.defn(self, '$dx_feel_negative_table', TMP_DoubleCross_dx_feel_negative_table_31 = function $$dx_feel_negative_table() {
      var self = this, table = nil;

      
      table = [[0, "侮蔑(ぶべつ)"], [5, "食傷(しょくしょう)"], [10, "脅威(きょうい)"], [15, "嫉妬(しっと)"], [20, "悔悟(かいご)"], [25, "恐怖(きょうふ)"], [30, "不安(ふあん)"], [35, "劣等感(れっとうかん)"], [40, "疎外感(そがいかん)"], [45, "恥辱(ちじょく)"], [50, "憐憫(れんびん)"], [55, "偏愛(へんあい)"], [60, "憎悪(ぞうお)"], [65, "隔意(かくい)"], [70, "嫌悪(けんお)"], [75, "猜疑心(さいぎしん)"], [80, "厭気(いやけ)"], [85, "不信感(ふしんかん)"], [90, "不快感(ふかいかん)"], [95, "憤懣(ふんまん)"], [100, "敵愾心(てきがいしん)"], [101, "無関心(むかんしん)"], [102, "任意(にんい)"]];
      return self.$dx_feel_table(table);
    }, TMP_DoubleCross_dx_feel_negative_table_31.$$arity = 0);
    return (Opal.defn(self, '$dx_feel_table', TMP_DoubleCross_dx_feel_table_32 = function $$dx_feel_table(table) {
      var $a, $b, self = this, dice_now = nil, output = nil;

      
      $b = self.$roll(1, 100), $a = Opal.to_ary($b), (dice_now = ($a[0] == null ? nil : $a[0])), $b;
      output = self.$get_table_by_number(dice_now, table);
      return [dice_now, output];
    }, TMP_DoubleCross_dx_feel_table_32.$$arity = 1), nil) && 'dx_feel_table';
  })($nesting[0], Opal.const_get_relative($nesting, 'DiceBot'), $nesting);
})(Opal);

/* Generated by Opal 0.11.4 */
(function(Opal) {
  var self = Opal.top, $nesting = [], nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice;

  Opal.add_stubs(['$exit']);
  return Opal.const_get_relative($nesting, 'Kernel').$exit()
})(Opal);
