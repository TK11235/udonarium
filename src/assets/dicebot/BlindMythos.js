/* Generated by Opal 1.0.3 */
(function(Opal) {
  function $rb_plus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs + rhs : lhs['$+'](rhs);
  }
  function $rb_gt(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs > rhs : lhs['$>'](rhs);
  }
  function $rb_minus(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs - rhs : lhs['$-'](rhs);
  }
  function $rb_ge(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs >= rhs : lhs['$>='](rhs);
  }
  function $rb_le(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs <= rhs : lhs['$<='](rhs);
  }
  function $rb_times(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs * rhs : lhs['$*'](rhs);
  }
  function $rb_divide(lhs, rhs) {
    return (typeof(lhs) === 'number' && typeof(rhs) === 'number') ? lhs / rhs : lhs['$/'](rhs);
  }
  var self = Opal.top, $nesting = [], nil = Opal.nil, $$$ = Opal.const_get_qualified, $$ = Opal.const_get_relative, $breaker = Opal.breaker, $slice = Opal.slice, $klass = Opal.klass, $truthy = Opal.truthy, $send = Opal.send, $hash2 = Opal.hash2;

  Opal.add_stubs(['$debug', '$judgeRoll', '$nil?', '$reRoll', '$getRulingPlanetDiceCommandResult', '$getDurtyTableCommandReuslt', '$getTableCommandResult', '$=~', '$!', '$last_match', '$to_i', '$+', '$getRollResult', '$getTotalResultMessageText', '$collect', '$split', '$each', '$empty?', '$>', '$size', '$each_with_index', '$==', '$-', '$roll', '$getSuccessResultText', '$find_all', '$>=', '$<<', '$getSameDieList', '$join', '$count', '$inject', '$uniq', '$<=', '$length', '$===', '$getRulingPlanetDice', '$include?', '$changeRulingPlanetDice', '$*', '$ceil', '$/', '$[]', '$freeze', '$setPrefixes', '$keys']);
  return (function($base, $super, $parent_nesting) {
    var self = $klass($base, $super, 'BlindMythos');

    var $nesting = [self].concat($parent_nesting), $BlindMythos_rollDiceCommand$1, $BlindMythos_judgeRoll$2, $BlindMythos_reRoll$3, $BlindMythos_getRollResult$6, $BlindMythos_getTotalResultMessageText$12, $BlindMythos_getSameDieList$15, $BlindMythos_getSuccessResultText$18, $BlindMythos_getRulingPlanetDiceCommandResult$20, $BlindMythos_getRulingPlanetDice$23, $BlindMythos_changeRulingPlanetDice$24, $BlindMythos_getDurtyTableCommandReuslt$25;

    
    Opal.const_set($nesting[0], 'ID', "BlindMythos");
    Opal.const_set($nesting[0], 'NAME', "ブラインド・ミトス");
    Opal.const_set($nesting[0], 'SORT_KEY', "ふらいんとみとす");
    Opal.const_set($nesting[0], 'HELP_MESSAGE', "" + "・判定：BMx@y>=z、BMSx@y>=z\n" + "  　x:スキルレベル\n" + "　　y:目標難易度（省略可。デフォルト4）\n" + "　　z:必要成功度\n" + "　BMコマンドはダイスの振り足しを常に行い、\n" + "　BMSは振り足しを自動では行いません。\n" + " 例）BM>=1　BM@3>=1　BMS2>=1\n" + "\n" + "・判定振り足し：ReRollx,x,x...@y>=1\n" + "  　x:振るダイスの個数\n" + "　　y:目標難易度（省略可。デフォルト4）\n" + "　　z:必要成功度\n" + "　振り足しを自動で行わない場合（BMSコマンド）に使用します。\n" + "\n" + "・LE：失う感情表\n" + "・感情後遺症表 ESx\n" + "　ESH：喜、ESA：怒、ESS：哀、ESP：楽、ESL：愛、ESE：感\n" + "・DT：汚染チャート\n" + "・RPxyz：守護星表チェック\n" + " xyz:守護星ナンバーを指定\n" + " 例）RP123　RP258\n");
    
    Opal.def(self, '$rollDiceCommand', $BlindMythos_rollDiceCommand$1 = function $$rollDiceCommand(command) {
      var $a, $b, self = this, text = nil, isStop = nil;

      
      self.$debug("rollDiceCommand Begin");
      text = self.$judgeRoll(command);
      if ($truthy(text['$nil?']())) {
      } else {
        return text
      };
      isStop = true;
      $b = self.$reRoll(command, isStop), $a = Opal.to_ary($b), (text = ($a[0] == null ? nil : $a[0])), $b;
      if ($truthy(text['$nil?']())) {
      } else {
        return text
      };
      text = self.$getRulingPlanetDiceCommandResult(command);
      if ($truthy(text['$nil?']())) {
      } else {
        return text
      };
      text = self.$getDurtyTableCommandReuslt(command);
      if ($truthy(text['$nil?']())) {
      } else {
        return text
      };
      text = self.$getTableCommandResult(command, $$($nesting, 'TABLES'));
      return text;
    }, $BlindMythos_rollDiceCommand$1.$$arity = 1);
    
    Opal.def(self, '$judgeRoll', $BlindMythos_judgeRoll$2 = function $$judgeRoll(command) {
      var $a, $b, self = this, isStop = nil, skillRank = nil, judgeNumberText = nil, judgeNumber = nil, targetNumber = nil, message = nil, diceCount = nil, isReRoll = nil, text = nil, bitList = nil, successList = nil, countOneList = nil, canReRoll = nil;

      
      if ($truthy(/^BM(S)?(\d*)(@(\d+))?>=(\d+)$/i['$=~'](command))) {
      } else {
        return nil
      };
      isStop = $$($nesting, 'Regexp').$last_match(1)['$nil?']()['$!']();
      skillRank = $$($nesting, 'Regexp').$last_match(2).$to_i();
      judgeNumberText = $$($nesting, 'Regexp').$last_match(3);
      judgeNumber = ($truthy($a = $$($nesting, 'Regexp').$last_match(4)) ? $a : 4).$to_i();
      targetNumber = ($truthy($a = $$($nesting, 'Regexp').$last_match(5)) ? $a : 1).$to_i();
      message = "";
      diceCount = $rb_plus(skillRank, 2);
      isReRoll = false;
      $b = self.$getRollResult([diceCount], judgeNumberText, judgeNumber, targetNumber, isReRoll, isStop), $a = Opal.to_ary($b), (text = ($a[0] == null ? nil : $a[0])), (bitList = ($a[1] == null ? nil : $a[1])), (successList = ($a[2] == null ? nil : $a[2])), (countOneList = ($a[3] == null ? nil : $a[3])), (canReRoll = ($a[4] == null ? nil : $a[4])), $b;
      message = $rb_plus(message, text);
      message = $rb_plus(message, self.$getTotalResultMessageText(bitList, successList, countOneList, targetNumber, isStop, canReRoll));
      return message;
    }, $BlindMythos_judgeRoll$2.$$arity = 1);
    
    Opal.def(self, '$reRoll', $BlindMythos_reRoll$3 = function $$reRoll(command, isStop) {
      var $a, $$4, $$5, $b, self = this, rerollCountsText = nil, judgeNumberText = nil, judgeNumber = nil, targetNumber = nil, rerollCounts = nil, commandText = nil, message = nil, isReRoll = nil, text = nil, _bitList = nil, successList = nil, countOneList = nil;

      
      self.$debug("ReRoll Begin", command);
      if ($truthy(/^ReRoll([\d,]+)(@(\d+))?>=(\d+)$/i['$=~'](command))) {
      } else {
        return nil
      };
      self.$debug("ReRoll pass");
      rerollCountsText = $$($nesting, 'Regexp').$last_match(1);
      judgeNumberText = $$($nesting, 'Regexp').$last_match(2);
      judgeNumber = ($truthy($a = $$($nesting, 'Regexp').$last_match(3)) ? $a : 4).$to_i();
      targetNumber = $$($nesting, 'Regexp').$last_match(4).$to_i();
      rerollCounts = $send(rerollCountsText.$split(/,/), 'collect', [], ($$4 = function(i){var self = $$4.$$s || this;

      
        
        if (i == null) {
          i = nil;
        };
        return i.$to_i();}, $$4.$$s = self, $$4.$$arity = 1, $$4));
      commandText = "";
      $send(rerollCounts, 'each', [], ($$5 = function(diceCount){var self = $$5.$$s || this;

      
        
        if (diceCount == null) {
          diceCount = nil;
        };
        if ($truthy(commandText['$empty?']())) {
        } else {
          commandText = $rb_plus(commandText, ",")
        };
        return (commandText = $rb_plus(commandText, "" + "ReRoll" + (diceCount) + (judgeNumberText) + ">=" + (targetNumber)));}, $$5.$$s = self, $$5.$$arity = 1, $$5));
      self.$debug("commandText", commandText);
      message = "";
      if ($truthy($rb_gt(rerollCounts.$size(), 1))) {
        if ($truthy(isStop)) {
          message = $rb_plus(message, "" + "(" + (commandText) + ")")}};
      message = $rb_plus(message, "\n");
      isReRoll = true;
      $b = self.$getRollResult(rerollCounts, judgeNumberText, judgeNumber, targetNumber, isReRoll, isStop), $a = Opal.to_ary($b), (text = ($a[0] == null ? nil : $a[0])), (_bitList = ($a[1] == null ? nil : $a[1])), (successList = ($a[2] == null ? nil : $a[2])), (countOneList = ($a[3] == null ? nil : $a[3])), $b;
      message = $rb_plus(message, text);
      return [message, successList, countOneList, targetNumber];
    }, $BlindMythos_reRoll$3.$$arity = 2);
    
    Opal.def(self, '$getRollResult', $BlindMythos_getRollResult$6 = function $$getRollResult(rerollCounts, judgeNumberText, judgeNumber, targetNumber, isReRoll, isStop) {
      var $$7, $a, $b, self = this, bitList = nil, successList = nil, countOneList = nil, rerollTargetList = nil, message = nil, rerollCommand = nil, canReRoll = nil, text = nil, successListTmp = nil, countOneListTmp = nil;

      
      bitList = [];
      successList = [];
      countOneList = [];
      rerollTargetList = [];
      message = "";
      $send(rerollCounts, 'each_with_index', [], ($$7 = function(diceCount, index){var self = $$7.$$s || this, $a, $b, $$8, $$9, $$10, $$11, commandName = nil, commandText = nil, isSort = nil, _ = nil, diceText = nil, diceList = nil, success = nil, countOne = nil, resultText = nil, sameDiceList = nil, rerollText = nil;

      
        
        if (diceCount == null) {
          diceCount = nil;
        };
        
        if (index == null) {
          index = nil;
        };
        if (index['$=='](0)) {
        } else {
          message = $rb_plus(message, "\n")
        };
        commandName = "" + "ReRoll" + (diceCount);
        if ($truthy(isReRoll)) {
        } else if ($truthy(isStop)) {
          commandName = "" + "BMS" + ($rb_minus(diceCount, 2))
        } else {
          commandName = "" + "BM" + ($rb_minus(diceCount, 2))
        };
        commandText = "" + (commandName) + (judgeNumberText) + ">=" + (targetNumber);
        isSort = 1;
        $b = self.$roll(diceCount, 6, isSort), $a = Opal.to_ary($b), (_ = ($a[0] == null ? nil : $a[0])), (diceText = ($a[1] == null ? nil : $a[1])), $b;
        diceList = $send(diceText.$split(/,/), 'collect', [], ($$8 = function(i){var self = $$8.$$s || this;

        
          
          if (i == null) {
            i = nil;
          };
          return i.$to_i();}, $$8.$$s = self, $$8.$$arity = 1, $$8));
        if ($truthy(isReRoll)) {
          message = $rb_plus(message, " ＞ ")};
        message = $rb_plus(message, "" + "(" + (commandText) + ") ＞ " + (diceCount) + "D6[" + (diceText) + "] ＞ ");
        $b = self.$getSuccessResultText(diceList, judgeNumber), $a = Opal.to_ary($b), (success = ($a[0] == null ? nil : $a[0])), (countOne = ($a[1] == null ? nil : $a[1])), (resultText = ($a[2] == null ? nil : $a[2])), $b;
        if ($truthy(isReRoll)) {
        } else {
          bitList = $rb_plus(bitList, $send(diceList, 'find_all', [], ($$9 = function(i){var self = $$9.$$s || this;

          
            
            if (i == null) {
              i = nil;
            };
            return $rb_ge(i, 4);}, $$9.$$s = self, $$9.$$arity = 1, $$9)))
        };
        successList['$<<'](success);
        countOneList['$<<'](countOne);
        message = $rb_plus(message, resultText);
        sameDiceList = self.$getSameDieList(diceList);
        if ($truthy(sameDiceList['$empty?']())) {
          return nil;};
        rerollText = "";
        $send(sameDiceList, 'each', [], ($$10 = function(list){var self = $$10.$$s || this;

        
          
          if (list == null) {
            list = nil;
          };
          if ($truthy(rerollText['$empty?']())) {
          } else {
            rerollText = $rb_plus(rerollText, ",")
          };
          return (rerollText = $rb_plus(rerollText, list.$join("")));}, $$10.$$s = self, $$10.$$arity = 1, $$10));
        rerollTargetList['$<<']($send(sameDiceList, 'collect', [], ($$11 = function(i){var self = $$11.$$s || this;

        
          
          if (i == null) {
            i = nil;
          };
          return i.$count();}, $$11.$$s = self, $$11.$$arity = 1, $$11)).$join(","));
        return (message = $rb_plus(message, "" + "、リロール[" + (rerollText) + "]"));}, $$7.$$s = self, $$7.$$arity = 2, $$7));
      rerollCommand = "";
      if ($truthy(rerollTargetList['$empty?']())) {
      } else {
        
        rerollCommand = "" + "ReRoll" + (rerollTargetList.$join(",")) + (judgeNumberText) + ">=" + (targetNumber);
        if ($truthy(isStop)) {
          message = $rb_plus(message, "" + "\n ＞ コマンド：" + (rerollCommand))};
      };
      canReRoll = rerollCommand['$empty?']()['$!']();
      if ($truthy(canReRoll)) {
        if ($truthy(isStop)) {
        } else {
          
          $b = self.$reRoll(rerollCommand, isStop), $a = Opal.to_ary($b), (text = ($a[0] == null ? nil : $a[0])), (successListTmp = ($a[1] == null ? nil : $a[1])), (countOneListTmp = ($a[2] == null ? nil : $a[2])), $b;
          message = $rb_plus(message, text);
          successList = $rb_plus(successList, successListTmp);
          countOneList = $rb_plus(countOneList, countOneListTmp);
        }};
      return [message, bitList, successList, countOneList, canReRoll];
    }, $BlindMythos_getRollResult$6.$$arity = 6);
    
    Opal.def(self, '$getTotalResultMessageText', $BlindMythos_getTotalResultMessageText$12 = function $$getTotalResultMessageText(bitList, successList, countOneList, targetNumber, isStop, canReRoll) {
      var $$13, $$14, $a, self = this, success = nil, countOne = nil, result = nil;

      
      success = $send(successList, 'inject', [], ($$13 = function(sum, i){var self = $$13.$$s || this;

      
        
        if (sum == null) {
          sum = nil;
        };
        
        if (i == null) {
          i = nil;
        };
        return $rb_plus(sum, i);}, $$13.$$s = self, $$13.$$arity = 2, $$13));
      countOne = $send(countOneList, 'inject', [], ($$14 = function(sum, i){var self = $$14.$$s || this;

      
        
        if (sum == null) {
          sum = nil;
        };
        
        if (i == null) {
          i = nil;
        };
        return $rb_plus(sum, i);}, $$14.$$s = self, $$14.$$arity = 2, $$14));
      result = "";
      if ($truthy($rb_gt(successList.$size(), 1))) {
        result = $rb_plus(result, "" + "\n ＞ 最終成功数:" + (success))};
      if ($truthy(($truthy($a = canReRoll) ? isStop : $a))) {
        
        result = $rb_plus(result, "\n");
        if ($truthy($rb_ge(success, targetNumber))) {
          result = $rb_plus(result, " ＞ 現状で成功。コマンド実行で追加リロールも可能")
        } else {
          
          result = $rb_plus(result, " ＞ 現状のままでは失敗");
          if ($truthy($rb_ge(countOne, 1))) {
            result = $rb_plus(result, "" + "。汚染ポイント+" + (countOne))};
        };
        return result;};
      if ($truthy($rb_ge(success, targetNumber))) {
        
        result = $rb_plus(result, " ＞ 成功");
        if ($truthy($rb_ge(bitList.$size(), 1))) {
          result = $rb_plus(result, "" + "、禁書ビット発生[" + (bitList.$join(",")) + "]")};
      } else {
        
        result = $rb_plus(result, " ＞ 失敗");
        if ($truthy($rb_ge(countOne, 1))) {
          result = $rb_plus(result, "" + "。汚染ポイント+" + (countOne))};
      };
      return result;
    }, $BlindMythos_getTotalResultMessageText$12.$$arity = 6);
    
    Opal.def(self, '$getSameDieList', $BlindMythos_getSameDieList$15 = function $$getSameDieList(diceList) {
      var $$16, self = this, sameDiceList = nil;

      
      sameDiceList = [];
      $send(diceList.$uniq(), 'each', [], ($$16 = function(i){var self = $$16.$$s || this, $$17, list = nil;

      
        
        if (i == null) {
          i = nil;
        };
        if (i['$=='](1)) {
          return nil;};
        list = $send(diceList, 'find_all', [], ($$17 = function(dice){var self = $$17.$$s || this;

        
          
          if (dice == null) {
            dice = nil;
          };
          return dice['$=='](i);}, $$17.$$s = self, $$17.$$arity = 1, $$17));
        if ($truthy($rb_le(list.$length(), 1))) {
          return nil;};
        return sameDiceList['$<<'](list);}, $$16.$$s = self, $$16.$$arity = 1, $$16));
      return sameDiceList;
    }, $BlindMythos_getSameDieList$15.$$arity = 1);
    
    Opal.def(self, '$getSuccessResultText', $BlindMythos_getSuccessResultText$18 = function $$getSuccessResultText(diceList, judgeNumber) {
      var $$19, self = this, success = nil, countOne = nil, result = nil;

      
      success = 0;
      countOne = 0;
      $send(diceList, 'each', [], ($$19 = function(i){var self = $$19.$$s || this;

      
        
        if (i == null) {
          i = nil;
        };
        if (i['$=='](1)) {
          countOne = $rb_plus(countOne, 1)};
        if ($truthy($rb_ge(i, judgeNumber))) {
        } else {
          return nil;
        };
        return (success = $rb_plus(success, 1));}, $$19.$$s = self, $$19.$$arity = 1, $$19));
      result = "" + "成功数:" + (success);
      return [success, countOne, result];
    }, $BlindMythos_getSuccessResultText$18.$$arity = 2);
    
    Opal.def(self, '$getRulingPlanetDiceCommandResult', $BlindMythos_getRulingPlanetDiceCommandResult$20 = function $$getRulingPlanetDiceCommandResult(command) {
      var $$21, $$22, self = this, targetNumbers = nil, diceList = nil, matchResult = nil, text = nil;

      
      if ($truthy(/^RP(\d+)/i['$==='](command))) {
      } else {
        return nil
      };
      targetNumbers = $send($$($nesting, 'Regexp').$last_match(1).$split(/(?:)/), 'collect', [], ($$21 = function(i){var self = $$21.$$s || this;

      
        
        if (i == null) {
          i = nil;
        };
        return i.$to_i();}, $$21.$$s = self, $$21.$$arity = 1, $$21));
      diceList = self.$getRulingPlanetDice();
      matchResult = "失敗";
      (function(){var $brk = Opal.new_brk(); try {return $send(targetNumbers, 'each', [], ($$22 = function(i){var self = $$22.$$s || this;

      
        
        if (i == null) {
          i = nil;
        };
        if ($truthy(diceList['$include?'](i))) {
          
          matchResult = "発動";
          
          Opal.brk(nil, $brk);
        } else {
          return nil
        };}, $$22.$$s = self, $$22.$$brk = $brk, $$22.$$arity = 1, $$22))
      } catch (err) { if (err === $brk) { return err.$v } else { throw err } }})();
      text = "" + "守護星表チェック(" + (targetNumbers.$join(",")) + ") ＞ " + (diceList.$count()) + "D10[" + (diceList.$join(",")) + "] ＞ " + (matchResult);
      return text;
    }, $BlindMythos_getRulingPlanetDiceCommandResult$20.$$arity = 1);
    
    Opal.def(self, '$getRulingPlanetDice', $BlindMythos_getRulingPlanetDice$23 = function $$getRulingPlanetDice() {
      var $a, $b, $c, self = this, dice1 = nil, dice2 = nil;

      
      $b = self.$roll(1, 10), $a = Opal.to_ary($b), (dice1 = ($a[0] == null ? nil : $a[0])), $b;
      dice2 = dice1;
      while (dice1['$=='](dice2)) {
        $c = self.$roll(1, 10), $b = Opal.to_ary($c), (dice2 = ($b[0] == null ? nil : $b[0])), $c
      };
      dice1 = self.$changeRulingPlanetDice(dice1);
      dice2 = self.$changeRulingPlanetDice(dice2);
      return [dice1, dice2];
    }, $BlindMythos_getRulingPlanetDice$23.$$arity = 0);
    
    Opal.def(self, '$changeRulingPlanetDice', $BlindMythos_changeRulingPlanetDice$24 = function $$changeRulingPlanetDice(dice) {
      var self = this;

      
      if (dice['$=='](10)) {
        return 0};
      return dice;
    }, $BlindMythos_changeRulingPlanetDice$24.$$arity = 1);
    
    Opal.def(self, '$getDurtyTableCommandReuslt', $BlindMythos_getDurtyTableCommandReuslt$25 = function $$getDurtyTableCommandReuslt(command) {
      var $a, $b, self = this, table = nil, dice1 = nil, dice2 = nil, index = nil;

      
      if ($truthy(/^DT$/i['$=~'](command))) {
      } else {
        return nil
      };
      table = "" + "汚染チャートを２回振り、その効果を適用する（1・2-2,5・6-12 なら振り直す）\n" + "ＰＣ全員の「トラウマ」「喪失」すべてに２ダメージ\n" + "ＰＣ全員の「喪失」２つに４ダメージ\n" + "ＰＣ全員の「トラウマ」すべてに２ダメージ。その後さらに汚染が２増える\n" + "ＰＣ全員、１つの【記憶】の両方の値が０になる。このときアクロバット骰子獲得不可\n" + "ＰＣ全員の「喪失」１つに４ダメージ。このときアクロバット骰子獲得不可\n" + "ＰＣ全員の「トラウマ」すべてに１ダメージ。その後さらに汚染が３増える\n" + "ＰＣ全員の「トラウマ」すべてに１ダメージ。その後アクロバット骰子をＰＣ人数分失う\n" + "ＰＣ全員の「喪失」すべてに２ダメージ。禁書ビットをすべて失う\n" + "ＰＣ全員の「トラウマ」２つに３ダメージ。その後さらに汚染が１増える\n" + "ＰＣ全員の「トラウマ」「喪失」すべてに１ダメージ\n" + "ＰＣ全員の「喪失」１つに４ダメージ。禁書ビットをすべて失う\n" + "ＰＣ全員の「トラウマ」すべてに２ダメージ\n" + "ＰＣ全員の１つの【記憶】の「トラウマ」「喪失」それぞれに３ダメージ\n" + "ＰＣ全員の「喪失」すべてに１ダメージ\n" + "ＰＣ全員の「トラウマ」３つに２ダメージ\n" + "ＰＣ全員の「トラウマ」と「喪失」それぞれ１つに３ダメージ\n" + "ＰＣ全員の「喪失」３つに２ダメージ\n" + "ＰＣ全員のすべての「トラウマ」に1 ダメージ\n" + "ＰＣ全員のひとつの【記憶】の「トラウマ」「喪失」それぞれに３ダメージ\n" + "ＰＣ全員の「喪失」すべてに２ダメージ\n" + "ＰＣ全員の「トラウマ」ひとつに４ダメージ。禁書ビットをすべて失う\n" + "ＰＣ全員の「トラウマ」「喪失」すべてに１ダメージ\n" + "ＰＣ全員の「喪失」２つに３ダメージ。その後さらに汚染が１増える\n" + "ＰＣ全員の「トラウマ」すべてに２ダメージ。禁書ビットをすべて失う\n" + "ＰＣ全員の「喪失」すべてに１ダメージ。その後アクロバット骰子をＰＣ人数分失う\n" + "ＰＣ全員の「喪失」すべてに１ダメージ。その後さらに汚染が３増える\n" + "ＰＣ全員の「トラウマ」１つに４ダメージ。このときアクロバット骰子獲得不可\n" + "ＰＣ全員、１つの【記憶】の両方の値が０になる。このときアクロバット骰子獲得不可\n" + "ＰＣ全員の「喪失」すべてに２ダメージ。その後さらに汚染が２増える\n" + "ＰＣ全員の「トラウマ」２つに４ダメージ\n" + "ＰＣ全員の「トラウマ」「喪失」すべてに２ダメージ\n" + "汚染チャートを２回振り、その効果を適用する（1・2-2,5・6-12 なら振り直す）\n";
      table = table.$split("\n");
      $b = self.$roll(1, 6), $a = Opal.to_ary($b), (dice1 = ($a[0] == null ? nil : $a[0])), $b;
      $b = self.$roll(2, 6), $a = Opal.to_ary($b), (dice2 = ($a[0] == null ? nil : $a[0])), $b;
      index = $rb_minus($rb_plus($rb_times($rb_minus(dice2, 2), 3), $rb_divide(dice1, 2.0).$ceil()), 1);
      return "" + "汚染チャート(" + (dice1) + "," + (dice2) + ") ＞ " + (table['$[]'](index));
    }, $BlindMythos_getDurtyTableCommandReuslt$25.$$arity = 1);
    Opal.const_set($nesting[0], 'TABLES', $hash2(["LE", "ESH", "ESA", "ESS", "ESP", "ESL", "ESE"], {"LE": $hash2(["name", "type", "table"], {"name": "失う感情表", "type": "1D6", "table": ["喜：喜びは消えた。嬉しい気持ちとは、なんだっただろう。", "怒：激情は失われ、憎しみもどこかへと消える。", "哀：どんなに辛くても、悲しさを感じない。どうやら涙も涸れたらしい。", "楽：もはや楽しいことなどない。希望を抱くだけ無駄なのだ。", "愛：愛など幻想……無力で儚い、役に立たない世迷い言だ。", "感：なにを見ても、感動はない。心は凍てついている。"]}), "ESH": $hash2(["name", "type", "table"], {"name": "「喜」の感情後遺症表", "type": "2D6", "table": ["日々喜びを求めてしまう。", "日々喜びを求めてしまう。", "嬉しい時間が長続きしない。", "素直に喜びを共有できないことがある。", "小さなことで大きく喜びを感じる。", "小さなことで大きく喜びを感じる。", "影響なし。", "影響なし。", "「喜」の後遺症をひとつ消してもよい。", "「喜」の後遺症をひとつ消してもよい。", "「喜」の後遺症をひとつ消してもよい。"]}), "ESA": $hash2(["name", "type", "table"], {"name": "「怒」の感情後遺症表", "type": "2D6", "table": ["始終不機嫌になる。", "始終不機嫌になる。", "一度怒ると、なかなか収まらない。", "怒りっぽくなる", "怒りかたが激しくなる。", "怒りかたが激しくなる。", "影響なし。", "影響なし。", "「怒」の後遺症をひとつ消してもよい。", "「怒」の後遺症をひとつ消してもよい。", "「怒」の後遺症をひとつ消してもよい。"]}), "ESS": $hash2(["name", "type", "table"], {"name": "「哀」の感情後遺症表", "type": "2D6", "table": ["一度涙が出るとなかなか止まらない。", "一度涙が出るとなかなか止まらない。", "夜、哀しいことを思い出して目が覚める。", "不意に哀しい気持ちになる。", "涙もろくなる。", "涙もろくなる。", "影響なし。", "影響なし。", "「哀」の後遺症をひとつ消してもよい。", "「哀」の後遺症をひとつ消してもよい。", "「哀」の後遺症をひとつ消してもよい。"]}), "ESP": $hash2(["name", "type", "table"], {"name": "「楽」の感情後遺症表", "type": "2D6", "table": ["突然陽気になったり、不意に笑い出してしまう。", "突然陽気になったり、不意に笑い出してしまう。", "周りが楽しくなさそうだと不安になる。", "楽しいことがないと落ち着かない。", "些細なことでも笑ってしまう。", "些細なことでも笑ってしまう。", "影響なし。", "影響なし。", "「楽」の後遺症をひとつ消してもよい。", "「楽」の後遺症をひとつ消してもよい。", "「楽」の後遺症をひとつ消してもよい。"]}), "ESL": $hash2(["name", "type", "table"], {"name": "「愛」の感情後遺症表", "type": "2D6", "table": ["少しでも気になる相手に愛を求めてしまう。", "少しでも気になる相手に愛を求めてしまう。", "愛する相手（恋人・家族・ペット・空想）から離れたくない。", "誰彼構わず優しくしてしまう。", "ひとりでいると不安を感じる。", "ひとりでいると不安を感じる。", "影響なし。", "影響なし。", "「愛」の後遺症をひとつ消してもよい。", "「愛」の後遺症をひとつ消してもよい。", "「愛」の後遺症をひとつ消してもよい。"]}), "ESE": $hash2(["name", "type", "table"], {"name": "「感」の感情後遺症表", "type": "2D6", "table": ["感動を共有できない相手を不信に思ってしまう。", "感動を共有できない相手を不信に思ってしまう。", "嬉しくても哀しくてもすぐに涙が出る。", "リアクションがオーバーになる。", "ちょっとしたことで感動する。", "ちょっとしたことで感動する。", "影響なし。", "影響なし。", "「感」の後遺症をひとつ消してもよい。", "「感」の後遺症をひとつ消してもよい。", "「感」の後遺症をひとつ消してもよい。"]})}).$freeze());
    return self.$setPrefixes($rb_plus(["BM.*", "ReRoll\\d+.*", "RP\\d+", "DT"], $$($nesting, 'TABLES').$keys()));
  })($nesting[0], $$($nesting, 'DiceBot'), $nesting)
})(Opal);
