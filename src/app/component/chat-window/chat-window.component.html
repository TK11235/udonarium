<!--<h2>チャットシステム</h2>-->
<div class="component">
  <div class="log">
    <chat-tab [chatTab]="chatTab" (onAddMessage)="scrollToBottom()"></chat-tab>
  </div>
  <div class="sticky-bottom">
    <form>
      <div class="chat-tab">
        <label *ngFor="let chatTab of chatMessageService.chatTabs; trackBy: trackByChatTab">
          <input name="chat-tab" type="radio" value="{{chatTab.identifier}}" ng-control="options"
            [(ngModel)]="chatTabidentifier">
          <div>{{chatTab.name}}<i *ngIf="chatTab.receiveInfo" class="material-icons">info</i>
            <badge *ngIf="chatTab.hasUnread" class="badge" [count]="chatTab.unreadLength"></badge>
          </div>
        </label>
        <button class="tab-setting small-font" (click)="showTabSetting()"><i
            class="material-icons small-font">settings</i>分頁設定</button>
        <button class="tab-setting small-font" (click)="onSoundEffectSwitchChanged()">
          <i *ngIf="!SoundEffectSwitch2()" class="material-icons icon-size">toggle_on</i>
          <i *ngIf="SoundEffectSwitch2()" class="material-icons icon-size">toggle_off</i>
          效果音
        </button>
      </div>
    </form>
    <div class="table" [ngClass]="{'direct-message': isDirect}">
      <div class="table-cell imagebox">
        <img class="image"
          *ngIf="gameCharacter && gameCharacter.imageFile != null && 0 < gameCharacter.imageFile?.url?.length"
          [src]="gameCharacter.imageFile?.url | safe: 'resourceUrl'" />
        <img class="image" *ngIf="!gameCharacter && myPeer && myPeer?.image != null"
          [src]="myPeer?.image?.url | safe: 'resourceUrl'" (click)="changeIcon()" />
        <img class="image" *ngIf="!gameCharacter && myPeer && myPeer?.image == null"
          [src]="'./assets/images/ic_account_circle_black_24dp_2x.png'| safe: 'resourceUrl'" (click)="changeIcon()" />
      </div>
      <div class="table-cell">
        <div>
          <div class="color-picker-container">
            <input class="color-picker" type="color" name="favcolor" value="#000000"
              (change)="onChangeColor($event.target.value)">
          </div>
          <select style="width: 12em;" (change)="onSelectedCharacter($event.target.value)">
            <option value="{{myPeer?.identifier}}">{{myPeer?.name}}（自己）</option>
            <option *ngFor="let gameCharacter of gameCharacters" value="{{gameCharacter.identifier}}">
              {{gameCharacter.name}}</option>
          </select> ＞
          <select style="width: 10em;" [(ngModel)]="sendTo">
            <option value="">全員</option>
            <option *ngFor="let peer of otherPeers" value="{{peer.identifier}}">{{peer.name}}<ng-container
                *ngIf="peer === myPeer">（自己）</ng-container>
            </option>
          </select>
          <select style="width: 12em;" (change)="onChangeGameType($event.target.value)" [(ngModel)]="gameType"
            [ngModelOptions]="{standalone: true}">
            <option value="">基本骰組(沒有指定)</option>
            <option *ngFor="let diceBotInfo of diceBotInfos" value="{{diceBotInfo.script}}">{{diceBotInfo.game}}
            </option>
          </select>
          <button (click)="showDicebotHelp()">?</button>
        </div>
        <div>
          <form #chatWindowForm="ngForm">
            <textarea #textArea [(ngModel)]="text" placeholder="Enter發送訊息  Shift+Enter換行"
              [ngModelOptions]="{standalone: true}" class="chat-input" (input)="onInput()"
              (keydown.enter)="sendChat($event)"></textarea>
            <button type="submit" (click)="sendChat(null)">SEND</button>
          </form>
        </div>
        <div class="writing-info">
          <ng-container *ngIf="0 < writingPeerNames.length">
            <span *ngFor="let peerName of writingPeerNames; index as i" style="font-weight: bold;">{{peerName}}<span
                *ngIf="writingPeerNames.length !== (i + 1)">, </span></span>
            <span> 輸入中...</span>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <!--<div style="white-space:pre-wrap; font-size: 8px;"><span>{{gameHelp}}</span></div>-->
